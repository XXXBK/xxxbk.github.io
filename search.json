[{"title":"Portainerå®¹å™¨ç®¡ç†å®æˆ˜ï¼šä»é•œåƒåŠ é€Ÿåˆ°å®‰å…¨éƒ¨ç½²","url":"/2025/07/15/Portainer%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BB%8E%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%88%B0%E5%AE%89%E5%85%A8%E9%83%A8%E7%BD%B2/","content":"ä¸€ã€èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆé€‰æ‹©ä»ç¬¬ä¸‰æ–¹é•œåƒæºæ‹‰å– Portainerï¼Ÿ\nè¿‘æœŸåœ¨å­¦ä¹ å®¹å™¨ç®¡ç†å·¥å…· Portainer æ—¶ï¼Œå‚è€ƒäº†ä¸€ç¯‡æŠ€æœ¯æ•™ç¨‹ï¼ˆçŸ¥ä¹é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com&#x2F;p&#x2F;27740131259ï¼‰ï¼Œæ•™ç¨‹ä¸­æ¨èä½¿ç”¨å®˜æ–¹é•œåƒæºéƒ¨ç½²ã€‚ä½†ç”±äºç½‘ç»œç¯å¢ƒé™åˆ¶ï¼Œå°è¯•ä»ç¬¬ä¸‰æ–¹é•œåƒæºdocker.1ms.runæ‹‰å– Portainer é•œåƒï¼Œæ„å¤–å‘ç°è¯¥é•œåƒæºæä¾›äº†æ›´ç¨³å®šçš„ä¸‹è½½é€Ÿåº¦ï¼Œå› æ­¤è®°å½•ä¸‹å®Œæ•´æ“ä½œæµç¨‹ï¼Œä¾›é‡åˆ°ç±»ä¼¼é—®é¢˜çš„å¼€å‘è€…å‚è€ƒã€‚\näºŒã€æ“ä½œæ­¥éª¤ï¼šä»é•œåƒæ‹‰å–åˆ°å®¹å™¨å¯åŠ¨çš„å…¨æµç¨‹\n1. æ‹‰å– Portainer é•œåƒ&#xA;é€šå¸¸æƒ…å†µä¸‹ï¼ŒPortainer å®˜æ–¹é•œåƒçš„æ‹‰å–å‘½ä»¤ä¸ºï¼š\ndocker pull portainer/portainer-ce:latest\n\nä½†æœ¬æ¬¡å°è¯•ä½¿ç”¨ç¬¬ä¸‰æ–¹é•œåƒæºï¼š\ndocker pull docker.1ms.run/portainer/portainer-ce:latest\n\næ‰§è¡Œç»“æœï¼š\nUsing default tag: latestlatest: Pulling from portainer/portainer-ce63c930229559: Pull complete&amp;#x20;d3b1c06ebf8c: Pull complete&amp;#x20;...ï¼ˆä¸­é—´å±‚æ‹‰å–çœç•¥ï¼‰Digest: sha256:224a378fbc5ae579dc9d570c5ca2e5e981a4a003c8d7c2c5b5e482af97c2f87cStatus: Downloaded newer image for docker.1ms.run/portainer/portainer-ce:latest\n\næ³¨æ„äº‹é¡¹ï¼š\n\nç¬¬ä¸‰æ–¹é•œåƒæºå¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ï¼Œå»ºè®®ä¼˜å…ˆä½¿ç”¨å®˜æ–¹é•œåƒï¼ˆportainer/portainer-ceï¼‰ã€‚\n\nè‹¥æ‹‰å–å¤±è´¥ï¼Œå¯æ£€æŸ¥é•œåƒæºæ˜¯å¦å¯ç”¨ï¼ˆå¦‚æ‰§è¡Œping docker.1ms.runï¼‰ï¼Œæˆ–åˆ‡æ¢è‡³å›½å†…åŠ é€Ÿæºï¼ˆå¦‚ Docker ä¸­å›½é•œåƒç«™ï¼‰ã€‚\n\n\n2. éªŒè¯é•œåƒæ˜¯å¦æˆåŠŸæ‹‰å–&#xA;é€šè¿‡docker imageså‘½ä»¤æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨ï¼š\ndocker images\n\nè¾“å‡ºç»“æœï¼š\nREPOSITORY                              TAG       IMAGE ID       CREATED       SIZEdocker.1ms.run/portainer/portainer-ce   latest    71de3839351a   2 days ago    268MB\n\n3. å¯åŠ¨ Portainer å®¹å™¨&#xA;ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å®¹å™¨ï¼Œå¹¶é…ç½®æŒ‚è½½ä¸ç«¯å£æ˜ å°„ï¼š\ndocker run -d \\\\&amp;#x20; \\--name portainer \\\\&amp;#x20; -p 9000:9000 \\\\&amp;#x20; -v /var/run/docker.sock:/var/run/docker.sock \\\\&amp;#x20; -v portainer\\_data:/data \\\\&amp;#x20; \\--restart=always \\\\&amp;#x20; docker.1ms.run/portainer/portainer-ce:latest\n\nå‚æ•°è§£æï¼š\n\n-dï¼šåå°è¿è¡Œå®¹å™¨ï¼›\n\n-p 9000:9000ï¼šæ˜ å°„å®¿ä¸»æœº 9000 ç«¯å£åˆ°å®¹å™¨ 9000 ç«¯å£ï¼Œç”¨äºè®¿é—® Web ç•Œé¢ï¼›\n\n-v /var/run/docker.sock:/var/run/docker.sockï¼šæŒ‚è½½ Docker å¥—æ¥å­—ï¼Œå…è®¸ Portainer ç®¡ç†å®¿ä¸»æœº Docker ç¯å¢ƒï¼›\n\n-v portainer_data:/dataï¼šåˆ›å»ºæ•°æ®å·æŒä¹…åŒ–å­˜å‚¨ Portainer é…ç½®ï¼›\n\n--restart=alwaysï¼šç¡®ä¿å®¹å™¨éšç³»ç»Ÿé‡å¯è‡ªåŠ¨è¿è¡Œã€‚\n\n\n4. è®¿é—® Portainer Web ç•Œé¢&#xA;å®¹å™¨å¯åŠ¨åï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://å®¿ä¸»æœºIP:9000ï¼Œé¦–æ¬¡è®¿é—®éœ€è®¾ç½®ç®¡ç†å‘˜å¯†ç ï¼Œéšåè¿›å…¥ Portainer ç®¡ç†ç•Œé¢ã€‚\nä¸‰ã€é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ\n1. é•œåƒæ‹‰å–å¤±è´¥ï¼šmanifest unknown&#xA;é”™è¯¯ä¿¡æ¯ï¼š\nError response from daemon: manifest for docker.1ms.run/portainer-ce:latest not found: manifest unknown\n\nåŸå› ï¼š\né•œåƒæºä¸­æ— è¯¥é•œåƒï¼Œæˆ–é•œåƒåç§°æ‹¼å†™é”™è¯¯ï¼ˆå¦‚portainer-ceå†™æˆportainerï¼‰ã€‚\nè§£å†³æ–¹æ³•ï¼š\nç¡®è®¤é•œåƒåç§°æ­£ç¡®æ€§ï¼Œæˆ–æ›´æ¢ä¸ºå®˜æ–¹é•œåƒæºæ‹‰å–ï¼š\ndocker pull portainer/portainer-ce:latest\n\n2. Docker Hub è¿æ¥è¶…æ—¶&#xA;é”™è¯¯ä¿¡æ¯ï¼š\nError response from daemon: Get &quot;https://registry-1.docker.io/v2/&quot;: context deadline exceeded\n\nè§£å†³æ–¹æ³•ï¼š\né…ç½®å›½å†…é•œåƒåŠ é€Ÿæºï¼Œç¼–è¾‘/etc/docker/daemon.jsonæ·»åŠ ï¼š\n&#123;&amp;#x20; &quot;registry-mirrors&quot;: \\[&quot;https://registry.docker-cn.com&quot;, &quot;https://docker.mirrors.ustc.edu.cn&quot;]&#125;\n\né‡å¯ Docker æœåŠ¡ï¼šsudo systemctl restart dockerã€‚\nå››ã€ä½¿ç”¨ç¬¬ä¸‰æ–¹é•œåƒæºçš„é£é™©ä¸å»ºè®®\n\nå®‰å…¨é£é™©ï¼šç¬¬ä¸‰æ–¹é•œåƒæºå¯èƒ½è¢«ç¯¡æ”¹ï¼Œå»ºè®®ä¼˜å…ˆä½¿ç”¨å®˜æ–¹é•œåƒï¼ˆportainer/portainer-ceï¼‰ã€‚\n\nç‰ˆæœ¬å…¼å®¹æ€§ï¼šç¬¬ä¸‰æ–¹é•œåƒå¯èƒ½éæœ€æ–°ç‰ˆæœ¬ï¼Œå»ºè®®å®šæœŸé€šè¿‡docker pullæ›´æ–°é•œåƒã€‚\n\nç½‘ç»œç¨³å®šæ€§ï¼šè‹¥ç¬¬ä¸‰æ–¹æºé¢‘ç¹å¤±æ•ˆï¼Œä¼˜å…ˆä½¿ç”¨å®˜æ–¹æºæˆ–å›½å†…å¤§å‚åŠ é€Ÿæºï¼ˆå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘é•œåƒç«™ï¼‰ã€‚\n\n\näº”ã€æ€»ç»“ï¼šPortainer çš„ä»·å€¼ä¸å®¹å™¨ç®¡ç†å®è·µ\né€šè¿‡ Docker éƒ¨ç½² Portainer åï¼Œå¯ç›´è§‚ç®¡ç†å®¹å™¨ã€é•œåƒã€ç½‘ç»œåŠæ•°æ®å·ï¼Œå°¤å…¶é€‚åˆæ–°æ‰‹å¿«é€Ÿä¸Šæ‰‹å®¹å™¨åŒ–éƒ¨ç½²ã€‚æœ¬æ¬¡ä»ç¬¬ä¸‰æ–¹é•œåƒæºæ‹‰å–çš„ç»å†è¡¨æ˜ï¼šæŠ€æœ¯å®è·µä¸­éœ€åœ¨æ•ˆç‡ä¸å®‰å…¨æ€§é—´æƒè¡¡ï¼Œå»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒå°è¯•éå®˜æ–¹æºï¼Œç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä½¿ç”¨å®˜æ–¹å¯ä¿¡é•œåƒã€‚\nåç»­å¯è¿›ä¸€æ­¥æ¢ç´¢ Portainer çš„ Kubernetes ç®¡ç†ã€RBAC æƒé™æ§åˆ¶ç­‰é«˜çº§åŠŸèƒ½ï¼Œæå‡å®¹å™¨åŒ–åº”ç”¨çš„éƒ¨ç½²ä¸è¿ç»´æ•ˆç‡ã€‚\n","categories":["Dockerå®è·µ"],"tags":["Docker","Portainer","é•œåƒåŠ é€Ÿ","å®¹å™¨ç®¡ç†"]},{"title":"Difyé•œåƒæºæ›¿æ¢ä¸æœåŠ¡å¯åŠ¨","url":"/2025/07/15/Dify-%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%EF%BC%9A%E9%95%9C%E5%83%8F%E6%BA%90%E6%9B%BF%E6%8D%A2%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8/","content":"Dify éƒ¨ç½²æµç¨‹ï¼šé•œåƒæºæ›¿æ¢ä¸æœåŠ¡å¯åŠ¨\nä¸€ã€Dify é•œåƒæºæ›¿æ¢æ“ä½œ\næ‰¹é‡æ›¿æ¢é•œåƒå‰ç¼€&#xA;åœ¨ docker-compose.yaml æ‰€åœ¨ç›®å½•æ‰§è¡Œå…¨å±€æ›¿æ¢ï¼Œæ·»åŠ  docker.1ms.run&#x2F; å‰ç¼€ï¼š\nsed -i &#x27;s/image: /image: docker.1ms.run\\\\//g&#x27; docker-compose.yaml\n\nç‰¹æ®Šé•œåƒè·¯å¾„ä¿®æ­£&#xA;é—®é¢˜è·¯å¾„&#xA;image: docker.1ms.run/docker.elastic.co/elasticsearch/elasticsearch:8.14.3\n\nä¿®æ­£å‘½ä»¤&#xA;sed -i &#x27;s|docker.1ms.run/docker.elastic.co/|docker.1ms.run/elastic/|g&#x27; docker-compose.yaml\n\næ­£ç¡®è·¯å¾„&#xA;image: docker.1ms.run/elastic/elasticsearch:8.14.3\n\nåŸºç¡€é•œåƒè¡¥å……æ›¿æ¢&#xA;sed -i &#x27;s|image: postgres:|image: docker.1ms.run/postgres:|g&#x27; docker-compose.yamlsed -i &#x27;s|image: redis:|image: docker.1ms.run/redis:|g&#x27; docker-compose.yamlsed -i &#x27;s|image: nginx:|image: docker.1ms.run/nginx:|g&#x27; docker-compose.yaml\n\näºŒã€éƒ¨ç½²å‰å‡†å¤‡å·¥ä½œ\nèµ‹äºˆæŒ‚è½½ç›®å½•æƒé™ï¼š\nchmod -R 777 ./volumes ./elasticsearch\n\nä¸‰ã€å¯åŠ¨ä¸éªŒè¯ Dify æœåŠ¡\nåå°å¯åŠ¨æœåŠ¡&#xA;docker-compose up -d\n\néªŒè¯æœåŠ¡çŠ¶æ€&#xA;docker-compose ps  # æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶æ€docker-compose logs -f  # æŸ¥çœ‹å®æ—¶æ—¥å¿—\n\nè®¿é—® Dify ç•Œé¢&#xA;æµè§ˆå™¨è¾“å…¥ http:&#x2F;&#x2F; æœåŠ¡å™¨ IP:3000ï¼Œé»˜è®¤è´¦å· admin@example.comï¼Œå¯†ç  passwordã€‚\nå››ã€éƒ¨ç½²è¿‡ç¨‹å¸¸è§é—®é¢˜\né•œåƒè·¯å¾„åµŒå¥—é”™è¯¯&#xA;é—®é¢˜&#xA;é•œåƒè·¯å¾„åŒ…å« docker.1ms.run&#x2F;docker.elastic.co&#x2F; åµŒå¥—ç»“æ„ã€‚\nè§£å†³&#xA;ä½¿ç”¨ sed ç²¾å‡†æ›¿æ¢ï¼š\nsed -i &#x27;s|docker.1ms.run/docker.elastic.co/|docker.1ms.run/elastic/|g&#x27; docker-compose.yaml\n\næƒé™ä¸è¶³å¯¼è‡´å¯åŠ¨å¤±è´¥&#xA;é—®é¢˜&#xA;æŒ‚è½½ç›®å½•æ— è¯»å†™æƒé™ã€‚\nè§£å†³&#xA;é€’å½’è®¾ç½®ç›®å½•æƒé™ï¼š\nchmod -R 777 ./volumes\n\næœåŠ¡å¯åŠ¨å¼‚å¸¸&#xA;è§£å†³&#xA;é€šè¿‡æ—¥å¿—æ’æŸ¥é—®é¢˜ï¼š&#x20;\ndocker-compose logs -f  # æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—docker-compose logs dify-api  # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—\n\näº”ã€æ ¸å¿ƒæ“ä½œæ€»ç»“\né•œåƒæ›¿æ¢æµç¨‹&#xA;å…¨å±€å‰ç¼€æ›¿æ¢ â†’ ç‰¹æ®Šé•œåƒè·¯å¾„ä¿®æ­£ â†’ åŸºç¡€é•œåƒè¡¥å……æ›¿æ¢\nå¯åŠ¨éªŒè¯æµç¨‹&#xA;docker-compose up -d â†’ docker-compose ps â†’ è®¿é—® Web ç•Œé¢\nå…³é”®å‘½ä»¤&#xA;sed -i &#x27;s/image: /image: docker.1ms.run\\\\//g&#x27; docker-compose.yamlchmod -R 777 ./volumesdocker-compose up -d","categories":["Dify"],"tags":["Dify","é•œåƒæº"]},{"title":"Python é­”æ³•ï¼šä¸€é”®è®© Excel æ­£ç¡®é€‰é¡¹ã€Œè„¸çº¢ã€","url":"/2025/07/15/Python-%E9%AD%94%E6%B3%95%EF%BC%9A%E4%B8%80%E9%94%AE%E8%AE%A9-Excel-%E6%AD%A3%E7%A1%AE%E9%80%89%E9%A1%B9%E3%80%8C%E8%84%B8%E7%BA%A2%E3%80%8D/","content":"åœ¨æ•°æ®å¤„ç†å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¤„ç† Excel æ–‡ä»¶ä¸­çš„è¯•é¢˜æ•°æ®ï¼Œç‰¹åˆ«æ˜¯éœ€è¦å¯¹æ­£ç¡®ç­”æ¡ˆè¿›è¡Œç‰¹æ®Šæ ‡è®°ã€‚æœ¬æ–‡å°†åˆ†äº«æˆ‘ä»æœ€åˆå®ç°åˆ°æœ€ç»ˆä¼˜åŒ–çš„å®Œæ•´æ”¹è¿›è¿‡ç¨‹ã€‚\nåˆå§‹éœ€æ±‚\næˆ‘ä»¬éœ€è¦å¤„ç†ä¸€ä¸ªåŒ…å«è¯•é¢˜çš„ Excel æ–‡ä»¶ï¼Œå…·ä½“è¦æ±‚ï¼š\n\næ–‡ä»¶åŒ…å« â€œè¯•é¢˜é€‰é¡¹â€ å’Œ â€œè¯•é¢˜ç­”æ¡ˆâ€ ä¸¤åˆ—\n\nè¯•é¢˜é€‰é¡¹ç”¨ â€œ$$;$â€œ åˆ†éš”å¤šä¸ªé€‰é¡¹\n\néœ€è¦æ ¹æ® â€œè¯•é¢˜ç­”æ¡ˆâ€ å°†æ­£ç¡®ç­”æ¡ˆæ ‡è®°ä¸ºçº¢è‰²\n\nå¤„ç†åçš„ç»“æœç›´æ¥ä¿®æ”¹åŸæ–‡ä»¶\n\n\nç¬¬ä¸€ç‰ˆå®ç°\næ ¸å¿ƒæ€è·¯ï¼š&#xA;\nä½¿ç”¨ pandas è¯»å– Excel æ–‡ä»¶\n\nç”¨ openpyxl ä¿®æ”¹åŸæ–‡ä»¶æ ·å¼\n\nåœ¨æ­£ç¡®ç­”æ¡ˆå‰åæ·»åŠ  â€œ**â€œ æ ‡è®°\n\næç¤ºç”¨æˆ·æ‰‹åŠ¨æ›¿æ¢ â€œ**â€œ ä¸ºçº¢è‰²æ ¼å¼\n\n\n\\# ä¸»è¦å¤„ç†é€»è¾‘marked\\_options = \\[]for i, option in enumerate(options):&amp;#x20;   if i in correct\\_indices:&amp;#x20;       marked\\_options.append(f&quot;\\*\\*&#123;option&#125;\\*\\*&quot;)  # ç”¨\\*\\*æ ‡è®°æ­£ç¡®ç­”æ¡ˆ&amp;#x20;   else:&amp;#x20;       marked\\_options.append(option)cell.value = &#x27;\\$;\\$&#x27;.join(marked\\_options)\n\né—®é¢˜ï¼š\nä¸èƒ½è‡ªåŠ¨è®¾ç½®çº¢è‰²ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ›¿æ¢ï¼Œ** çš„æ ‡è®°æ–¹å¼ä¸å¤Ÿç›´è§‚\nç¬¬äºŒç‰ˆæ”¹è¿›\næ”¹è¿›ç‚¹ï¼š&#xA;\næ”¹ç”¨ xlsxwriter å¼•æ“\n\nç›´æ¥å¤„ç† ** æ ‡è®°çš„å†…å®¹å¹¶è®¾ç½®ä¸ºçº¢è‰²\n\nä¿ç•™ ** æ ‡è®°\n\n\n\\# ä½¿ç”¨æ­£åˆ™åŒ¹é…\\*\\*å†…å®¹å¹¶è®¾ç½®æ ¼å¼for match in re.finditer(r&#x27;\\\\\\\\\\\\\\*\\\\\\\\\\\\\\*(.\\*?)\\\\\\\\\\\\\\*\\\\\\\\\\\\\\*&#x27;, cell\\_value):&amp;#x20;   parts.append(&#123;&amp;#x20;       &#x27;text&#x27;: f&quot;\\*\\*&#123;match.group(1)&#125;\\*\\*&quot;,&amp;#x20;       &#x27;format&#x27;: red\\_format&amp;#x20;   &#125;)\n\né—®é¢˜ï¼š\nä½¿ç”¨ ** å°†æ­£ç¡®ç­”æ¡ˆæ‹¬èµ·æ¥çš„è¯ï¼Œxlsxwriter æ— æ³•éå¸¸å‡†ç¡®åœ°è§£æå‡ºæ¥ï¼Œå› ä¸ºç­”æ¡ˆå¯èƒ½æ˜¯ A$;$B$;$C$;$D è¿™æ ·å­çš„ï¼Œç›¸åŒçš„ç¬¦å·ä¼šå¹²æ‰°å®ƒçš„åˆ¤æ–­ï¼Œä»è€Œå¯¼è‡´æ•ˆæœä¸å¥½\næœ€ç»ˆç‰ˆæ”¹è¿›\næ”¹è¿›æ€è·¯ï¼š&#xA;\næ”¹å›ä½¿ç”¨ openpyxl\n\næ­£ç¡®ç­”æ¡ˆç”¨ [] æ ‡è®°\n\néæ­£ç¡®ç­”æ¡ˆä¸åšæ ‡è®°\n\n\nmarked\\_options = \\[]for i, option in enumerate(options):&amp;#x20;   if i in correct\\_indices:&amp;#x20;       marked\\_options.append(f&quot;\\[&#123;option&#125;]&quot;) # æ­£ç¡®ç­”æ¡ˆæ ‡è®°&amp;#x20;   else:&amp;#x20;       marked\\_options.append(option)\n\nç„¶åå†è¿›è¡Œæ ‡çº¢å¤„ç†ï¼š\n\nä½¿ç”¨å¯Œæ–‡æœ¬ (CellRichText) ç›´æ¥è®¾ç½®çº¢è‰²\n\nè‡ªåŠ¨ç§»é™¤ [] æ ‡è®°\n\næ·»åŠ å¼‚å¸¸å¤„ç†ï¼Œå¤±è´¥æ—¶å›é€€åˆ°æ™®é€šæ–‡æœ¬\n\næ›´å‹å¥½çš„æç¤ºä¿¡æ¯\n\n\n\\# å¯Œæ–‡æœ¬å¤„ç†æ ¸å¿ƒä»£ç rich\\_text = CellRichText()for i, option in enumerate(options):&amp;#x20;   if i &gt; 0:&amp;#x20;       rich\\_text.append(&#x27;\\$;\\$&#x27;)&amp;#x20;   clean\\_option = option.replace(&#x27;\\[&#x27;, &#x27;&#x27;).replace(&#x27;]&#x27;, &#x27;&#x27;)&amp;#x20;   if i in correct\\_indices:&amp;#x20;       rich\\_text.append(TextBlock(inline\\_red\\_font, clean\\_option))&amp;#x20;   else:&amp;#x20;       rich\\_text.append(clean\\_option)cell.value = rich\\_text\n\nå…³é”®æ”¹è¿›ç‚¹ï¼š&#xA;\nå¯Œæ–‡æœ¬æ”¯æŒï¼šä½¿ç”¨ CellRichText å’Œ TextBlock å®ç°å¯¹å•ä¸ªå­—ç¬¦çš„æ ·å¼è®¾ç½®\n\nè‡ªåŠ¨æ¸…ç†ï¼šç§»é™¤é€‰é¡¹ä¸­çš„ [] æ ‡è®°\n\n\næ‹“å±•åŠŸèƒ½ï¼šæ ‡è®°æ£€æŸ¥ä¸ç»Ÿä¸€åˆ†éš”ç¬¦\nåœ¨æœ€ç»ˆç‰ˆçš„åŸºç¡€ä¸Šï¼Œæˆ‘è¿›ä¸€æ­¥å®Œå–„äº†ä»£ç ï¼Œå¢åŠ äº†ä¸¤é¡¹é‡è¦çš„åŠŸèƒ½ï¼šç»Ÿä¸€å¤„ç†éæ ‡å‡†åˆ†éš”ç¬¦å’Œå…¨é¢çš„æ ‡è®°æ£€æŸ¥æŠ¥å‘Šã€‚è¿™ä½¿å¾—æ•´ä¸ªæµç¨‹æ›´åŠ å¥å£®å’Œæ™ºèƒ½åŒ–ã€‚\n1. ç»Ÿä¸€åˆ†éš”ç¬¦&#xA;å¾ˆå¤šæ—¶å€™ï¼ŒExcel ä¸­çš„é€‰é¡¹åˆ†éš”ç¬¦å¯èƒ½ä¸ç»Ÿä¸€ï¼Œé™¤äº†æ ‡å‡†çš„$;$ï¼Œè¿˜å¯èƒ½å‡ºç°$;ã€$$ç­‰ï¼Œç”šè‡³å•ç©ºæ ¼åŠ  $ ç­‰å¤šç§å½¢å¼ã€‚ä¸ºäº†ç¡®ä¿é€‰é¡¹èƒ½å¤Ÿè¢«æ­£ç¡®è§£æï¼Œæˆ‘åŠ å…¥äº†å¼ºå¤§çš„æ­£åˆ™è¡¨è¾¾å¼æ¥è¯†åˆ«å¹¶ç»Ÿä¸€è¿™äº›éæ ‡å‡†åˆ†éš”ç¬¦ä¸º $;$ã€‚\nå®ç°æ–¹å¼ï¼šä½¿ç”¨ re.compile å®šä¹‰äº†ä¸€ä¸ªè¯¦ç»†çš„æ­£åˆ™è¡¨è¾¾å¼ separator_patternï¼Œæ¶µç›–äº†å¤šç§å¸¸è§çš„éæ ‡å‡†åˆ†éš”ç¬¦ã€‚\næ•ˆæœï¼šåœ¨å¤„ç†æ¯ä¸ªé€‰é¡¹å­—ç¬¦ä¸²æ—¶ï¼Œé¦–å…ˆä½¿ç”¨ separator_pattern.sub (â€˜$;$â€™, options_str) å°†æ‰€æœ‰è¯†åˆ«åˆ°çš„éæ ‡å‡†åˆ†éš”ç¬¦ç»Ÿä¸€æ›¿æ¢ä¸º $;$ ã€‚è¿™å¤§å¤§æé«˜äº†æ•°æ®å¤„ç†çš„é²æ£’æ€§ï¼Œå‡å°‘äº†å› æ ¼å¼ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ã€‚\n\\# æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰ï¼ˆéƒ¨åˆ†ï¼‰separator\\_pattern = re.compile(r&#x27;&#x27;&#x27;&amp;#x20;   \\$;\\$|       # æ ‡å‡† \\$;\\$ \\[cite: 3]&amp;#x20;   \\$:ï¼š\\$|   # \\$:\\$ æˆ– \\$ï¼š\\$ \\[cite: 4]&amp;#x20;   ;\\$|         # ;\\$ \\[cite: 5]&amp;#x20;   \\$ï¼›|        # \\$ï¼› \\[cite: 6]&amp;#x20;   \\[ï¼›:ï¼š]\\$|   # ï¼›\\$ æˆ– ï¼š\\$ \\[cite: 7]&amp;#x20;   $\\[;ï¼›:ï¼š]|  # \\$; æˆ– \\$ï¼›æˆ– \\$: æˆ– \\$ï¼š \\[cite: 8]&amp;#x20;   \\$\\$|        # \\$\\$ \\[cite: 9]&amp;#x20;   \\s&#123;2,&#125;|      # ä¸¤ä¸ªæˆ–æ›´å¤šç©ºæ ¼ \\[cite: 10]&amp;#x20;   \\$\\s|\\s\\$|   # \\$ åæˆ–å‰æœ‰å•ä¸ªç©ºæ ¼ \\[cite: 11]&amp;#x20;   ;           # å•ç‹¬çš„åˆ†å· \\[cite: 12]&#x27;&#x27;&#x27;, re.VERBOSE)\\# åœ¨å¤„ç†é€‰é¡¹å­—ç¬¦ä¸²æ—¶è¿›è¡Œæ›¿æ¢modified\\_str = separator\\_pattern.sub(&#x27;\\$;\\$&#x27;, options\\_str)\n\n2. æ ‡è®°æ£€æŸ¥æŠ¥å‘Š&#xA;ä»…ä»…å¯¹æ­£ç¡®ç­”æ¡ˆè¿›è¡Œæ ‡è®°æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦éªŒè¯æ ‡è®°æ˜¯å¦æ­£ç¡®ã€æ˜¯å¦æœ‰é—æ¼ã€‚æ­¤åŠŸèƒ½å¯ä»¥ç”Ÿæˆè¯¦ç»†çš„æŠ¥å‘Šï¼ŒæŒ‡å‡º â€œæ­£ç¡®ç­”æ¡ˆæœªè¢«æ ‡è®°â€ å’Œ â€œé”™è¯¯ç­”æ¡ˆè¢«æ ‡è®°â€ çš„æƒ…å†µã€‚\næ ¸å¿ƒé€»è¾‘ä¼˜åŒ–ï¼š&#xA;\næœªæ ‡è®°æ£€æŸ¥ï¼šä¼ ç»Ÿçš„æ£€æŸ¥æ–¹æ³•æ˜¯çœ‹ â€œæ ‡è®°ç´¢å¼•â€ ä¸­æ˜¯å¦åŒ…å«æ­£ç¡®ç­”æ¡ˆçš„ç´¢å¼•ã€‚ä½†å¦‚æœæ­£ç¡®ç­”æ¡ˆå®Œå…¨æ²¡æœ‰è¢«æ ‡è®°ï¼ˆå³é€‰é¡¹ä¸­æ ¹æœ¬æ²¡æœ‰ []ï¼‰ï¼Œè¿™ç§æ–¹æ³•å°±æ— æ³•è¯†åˆ«ã€‚æ–°çš„é€»è¾‘ç›´æ¥æ£€æŸ¥æ­£ç¡®ç­”æ¡ˆçš„é€‰é¡¹å†…å®¹æ˜¯å¦è¢« [] åŒ…è£¹ ã€‚åªè¦æ­£ç¡®ç­”æ¡ˆæœªè¢« [] åŒ…è£¹ï¼Œæ— è®ºæ˜¯å¦æœ‰å…¶ä»–æ ‡è®°åŠ¨ä½œï¼Œéƒ½ä¼šè¢«è¯†åˆ«ä¸º â€œæœªæ ‡è®°â€ ã€‚\n\né”™è¯¯æ ‡è®°æ£€æŸ¥ï¼šæ£€æŸ¥æ‰€æœ‰è¢« [] åŒ…è£¹çš„é€‰é¡¹ï¼Œå¦‚æœå…¶ç´¢å¼•ä¸åœ¨æ­£ç¡®ç­”æ¡ˆçš„ç´¢å¼•åˆ—è¡¨ä¸­ï¼Œåˆ™è§†ä¸ºé”™è¯¯æ ‡è®° ã€‚\n\n\nè¾“å‡ºæŠ¥å‘Šï¼š&#xA;ç”Ÿæˆæ¸…æ™°çš„æŠ¥å‘Šï¼ŒåŒ…å«ï¼š\n\næ£€æŸ¥çš„æ€»è¡Œæ•° ã€‚\n\nâ€œæœªæ ‡è®°æ­£ç¡®ç­”æ¡ˆçš„è¡Œâ€ æ•°é‡åŠå…·ä½“è¯¦æƒ…ï¼ˆExcel è¡Œå·ã€åº”æ ‡è®°çš„å­—æ¯ã€æœªè¢«åŒ…è£¹çš„å®é™…å†…å®¹ï¼‰ ã€‚\n\nâ€œé”™è¯¯æ ‡è®°çš„è¡Œâ€ æ•°é‡åŠå…·ä½“è¯¦æƒ…ï¼ˆExcel è¡Œå·ã€é”™è¯¯æ ‡è®°çš„å†…å®¹ã€æ­£ç¡®çš„ç­”æ¡ˆï¼‰ ã€‚\n\n\n\\# æœªæ ‡è®°è¡Œæ£€æŸ¥çš„æ ¸å¿ƒä»£ç has\\_unmarked = Falsefor i in correct\\_indices:&amp;#x20;   opt = options\\[i]&amp;#x20;   \\# ç›´æ¥æ£€æŸ¥æ­£ç¡®ç­”æ¡ˆæ˜¯å¦è¢«\\[]åŒ…è£¹&amp;#x20;&amp;#x20;   if not (opt.strip().startswith(&#x27;\\[&#x27;) and opt.strip().endswith(&#x27;]&#x27;)):&amp;#x20;       has\\_unmarked = True&amp;#x20;       breakif has\\_unmarked: # \\[cite: 16]&amp;#x20;   unmarked\\_rows.append(&#123;&amp;#x20;       &#x27;row&#x27;: row\\_num,&amp;#x20;       &#x27;expected&#x27;: \\[chr(65 + i) for i in correct\\_indices],&amp;#x20;       &#x27;actual&#x27;: \\[options\\[i].strip() for i in correct\\_indices]&amp;#x20;   &#125;)\\# é”™è¯¯æ ‡è®°è¡Œæ£€æŸ¥çš„æ ¸å¿ƒä»£ç marked\\_indices = \\[]for i, opt in enumerate(options):&amp;#x20;   if opt.strip().startswith(&#x27;\\[&#x27;) and opt.strip().endswith(&#x27;]&#x27;):&amp;#x20;       marked\\_indices.append(i)  # è®°å½•è¢«æ ‡è®°çš„ç´¢å¼•for i in marked\\_indices: #&amp;#x20;&amp;#x20;   if i not in correct\\_indices:&amp;#x20;       wrong\\_marking.append(&#123;&amp;#x20;           &#x27;row&#x27;: row\\_num,&amp;#x20;           &#x27;wrong\\_marked&#x27;: options\\[i].strip(),&amp;#x20;           &#x27;correct&#x27;: \\[chr(65 + i) for i in correct\\_indices] #&amp;#x20;&amp;#x20;       &#125;)&amp;#x20;       break # åªè¦æœ‰ä¸€ä¸ªé”™è¯¯æ ‡è®°å°±è®°å½•\n\néªŒè¯ç¤ºä¾‹ï¼š&#xA;å¦‚æœä¸€ä¸ª Excel è¡Œçš„æ­£ç¡®ç­”æ¡ˆæ˜¯ Dï¼Œä½†é€‰é¡¹ D æ²¡æœ‰è¢« [] åŒ…è£¹ï¼Œè¿è¡Œä»£ç åä¼šè¾“å‡ºï¼š\n\\=== æ ‡è®°æ£€æŸ¥æŠ¥å‘Š ===å…±æ£€æŸ¥ 1000 è¡Œæ•°æ®1\\. æœªæ ‡è®°æ­£ç¡®ç­”æ¡ˆçš„è¡Œ: 1 è¡Œ&amp;#x20; è¡ŒX: åº”æ ‡è®°\\[&#x27;D&#x27;]ï¼ˆå†…å®¹ï¼šDã€è´¢åŠ¡æ”¶æ”¯å®¡æ‰¹äººå‘˜çš„å¥–æƒ©åŠæ³•ï¼‰æœªè¢«\\[]åŒ…è£¹2\\. é”™è¯¯æ ‡è®°çš„è¡Œ: 0 è¡Œ\n\nè¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿç²¾å‡†è¯†åˆ« â€œåº”è¯¥æ ‡è®°ä½†å®Œå…¨æ²¡æ ‡è®°â€ çš„æƒ…å†µ ã€‚\n","categories":["Excel","Python","æ•°æ®å¤„ç†"],"tags":["Excel","Pandas","Python","Openpyxl","Xlsxwriter","æ­£åˆ™è¡¨è¾¾å¼"]},{"title":"dockerç¦»çº¿éƒ¨ç½²ï¼šç©¿è¶Šç½‘ç»œå±éšœçš„å®¹å™¨ç¼–æ’åˆ©å™¨","url":"/2025/07/16/docker%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2%EF%BC%9A%E7%A9%BF%E8%B6%8A%E7%BD%91%E7%BB%9C%E5%B1%8F%E9%9A%9C%E7%9A%84%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E5%88%A9%E5%99%A8/","content":"ä¸€ã€Docker Compose ç¦»çº¿å®‰è£…æ­¥éª¤\nåœ¨ GitHub ä¸Šæ‰¾åˆ°å¯¹åº”çš„ docker-compose ç½‘ç«™ï¼Œä¸‹è½½é€‚åˆå½“å‰ç³»ç»Ÿçš„ç¦»çº¿å®‰è£…åŒ…ï¼ˆå¦‚ docker-compose-linux-x86_64ï¼‰ï¼Œå¹¶å°†å…¶æ”¾ç½®åœ¨ &#x2F;tmp ç›®å½•ä¸‹ã€‚\nèµ‹äºˆæ‰§è¡Œæƒé™å¹¶ç§»åŠ¨è‡³ç³»ç»Ÿè·¯å¾„&#xA;\\# èµ‹äºˆå¯æ‰§è¡Œæƒé™chmod +x /tmp/docker-compose-linux-x86\\_64\\# ç§»åŠ¨åˆ°ç³»ç»Ÿå¯æ‰§è¡Œç›®å½•sudo mv /tmp/docker-compose-linux-x86\\_64 /usr/local/bin/docker-compose\n\néªŒè¯å®‰è£…ç»“æœ&#xA;docker-compose --version\\# è¾“å‡ºç¤ºä¾‹ï¼šdocker-compose version 2.20.3, build a8266d3\n\näºŒã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ³•\næƒé™ä¸è¶³é—®é¢˜&#xA;é—®é¢˜&#xA;æ‰§è¡Œ mv æ—¶æç¤ºæƒé™é”™è¯¯ã€‚\nè§£å†³&#xA;ä½¿ç”¨ sudo å‘½ä»¤è·å–ç®¡ç†å‘˜æƒé™ï¼š\nsudo mv /tmp/docker-compose-linux-x86\\_64 /usr/local/bin/docker-compose\n\nå‘½ä»¤ä¸å­˜åœ¨é—®é¢˜&#xA;é—®é¢˜&#xA;è¾“å…¥ docker-compose æç¤ºå‘½ä»¤æœªæ‰¾åˆ°ã€‚\nè§£å†³&#xA;æ£€æŸ¥ç³»ç»Ÿè·¯å¾„æ˜¯å¦åŒ…å« &#x2F;usr&#x2F;local&#x2F;binï¼š\necho \\$PATH  # è‹¥ä¸å« /usr/local/binï¼Œæ·»åŠ è‡³ç¯å¢ƒå˜é‡export PATH=\\$PATH:/usr/local/bin\n\næ–‡ä»¶åç©ºæ ¼é—®é¢˜&#xA;é—®é¢˜&#xA;è„šæœ¬æ–‡ä»¶åå«å‰å¯¼ç©ºæ ¼å¯¼è‡´å‘½ä»¤å¤±è´¥ã€‚\nè§£å†³&#xA;é‡å‘½åæ–‡ä»¶å»é™¤ç©ºæ ¼ï¼š\nmv &#x27; replace\\_image\\_registry.sh&#x27; replace\\_image\\_registry.sh\n\nä¸‰ã€æ ¸å¿ƒå‘½ä»¤æ€»ç»“\nå®‰è£…æ ¸å¿ƒæ­¥éª¤&#xA;ä¸‹è½½ â†’ èµ‹æƒ â†’ ç§»åŠ¨ â†’ éªŒè¯\nå…³é”®å‘½ä»¤&#xA;chmod +x /tmp/docker-compose-linux-x86\\_64sudo mv /tmp/docker-compose-linux-x86\\_64 /usr/local/bin/docker-composedocker-compose --version\n\n","categories":["å®¹å™¨æŠ€æœ¯","éƒ¨ç½²å®è·µ"],"tags":["Docker Compose","ç¦»çº¿å®‰è£…","Linux"]},{"title":"Python é­”æ³•ï¼šä¸€é”®è®© Excel æ­£ç¡®é€‰é¡¹ã€Œè„¸çº¢ã€","url":"/2025/07/15/Python%E9%AD%94%E6%B3%95%EF%BC%9A%E5%A6%82%E4%BD%95%E7%94%A8%E7%89%B9%E5%BE%81%E8%AF%86%E5%88%AB%E8%AE%A9PDF%E6%B0%B4%E5%8D%B0%E9%9A%90%E5%BD%A2%EF%BC%9F/","content":"åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°å¸¦æœ‰ç‰¹å®šç‰¹å¾çš„ PDF æ°´å°ï¼Œæ¯”å¦‚å›ºå®šçš„å­—ä½“å¤§å°ã€å€¾æ–œè§’åº¦ã€é€æ˜åº¦å’Œé¢œè‰²ã€‚è¿™äº›ç‰¹æ€§ä¸ºæˆ‘ä»¬æä¾›äº†æ›´ç²¾å‡†åœ°è¯†åˆ«æ°´å°çš„ä¾æ®ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥æ·±å…¥æ¢è®¨å¦‚ä½•åˆ©ç”¨ PyMuPDF (Fitz) åº“ï¼ŒåŸºäºè¿™äº›ç‰¹å¾å®ç° PDF æ°´å°çš„ç²¾ç¡®è¯†åˆ«å’Œå»é™¤ï¼Œå¹¶æ•´åˆå¤šç§å®ç”¨æ–¹æ³•ï¼Œå¸®ä½ åº”å¯¹ä¸åŒåœºæ™¯ã€‚\nç‰¹å®šç‰¹å¾æ°´å°çš„è¯†åˆ«åŸç†\nPDF æ–‡ä»¶ä¸­çš„æ–‡æœ¬å’Œå›¾å½¢å¯¹è±¡éƒ½åŒ…å«äº†ä¸°å¯Œçš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¾‹å¦‚å­—ä½“å¤§å°ã€æ—‹è½¬è§’åº¦ã€é€æ˜åº¦å’Œé¢œè‰²ã€‚å½“æ°´å°å…·æœ‰å›ºå®šç‰¹å¾æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ç²¾å‡†è¯†åˆ«ï¼š\n\nè§£æ PDF é¡µé¢å†…å®¹ï¼š è·å–é¡µé¢ä¸Šæ‰€æœ‰çš„æ–‡æœ¬å’Œå›¾å½¢å¯¹è±¡ã€‚\n\næå–å¯¹è±¡ç‰¹å¾ï¼š è·å–æ¯ä¸ªå¯¹è±¡çš„å­—ä½“å¤§å°ã€æ—‹è½¬è§’åº¦ã€é€æ˜åº¦å’Œé¢œè‰²ç­‰ä¿¡æ¯ã€‚\n\nç‰¹å¾åŒ¹é…ï¼š å°†æå–åˆ°çš„ç‰¹å¾ä¸æˆ‘ä»¬å·²çŸ¥çš„æ°´å°ç‰¹å¾è¿›è¡Œæ¯”å¯¹ã€‚\n\nå¤„ç†åŒ¹é…å¯¹è±¡ï¼š å¯¹ç¬¦åˆæ°´å°ç‰¹å¾çš„å¯¹è±¡è¿›è¡Œåˆ é™¤æˆ–è¦†ç›–å¤„ç†ã€‚\n\n\nå…¸å‹çš„ PDF æ°´å°é€šå¸¸å…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼š\n\nğŸ“ å›ºå®šå€¾æ–œè§’åº¦ (å¸¸è§ 15-45 åº¦)\n\nğŸ¨ å›ºå®šé¢œè‰² (å¸¸è§æµ…ç°è‰² #C0C0C0)\n\nğŸŒ« å›ºå®šé€æ˜åº¦ (çº¦ 30-50%)\n\nğŸ”  å›ºå®šå­—ä½“å¤§å° (é€šå¸¸è¾ƒå¤§)\n\nğŸ”„ é‡å¤å‡ºç°åœ¨æ¯ä¸€é¡µç›¸åŒä½ç½®\n\n\nä½¿ç”¨ PyMuPDF å®ç°åŸºäºç‰¹å¾çš„æ°´å°å¤„ç†\næ–¹æ³•ä¸€ï¼šåŸºäºå­—ä½“å¤§å°å’Œæ—‹è½¬è§’åº¦çš„æ°´å°è¯†åˆ«&#xA;è¿™ä¸ªæ–¹æ³•éå¸¸é€‚åˆé‚£äº›å­—ä½“å¤§å°å’Œå€¾æ–œè§’åº¦éƒ½æ¯”è¾ƒå›ºå®šçš„æ°´å°ã€‚\nimport fitzdef remove\\_watermark\\_by\\_font\\_size\\_and\\_rotation(input\\_pdf, output\\_pdf, font\\_size, rotation\\_angle):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   æ ¹æ®å­—ä½“å¤§å°å’Œæ—‹è½¬è§’åº¦å»é™¤PDFä¸­çš„æ°´å°ã€‚&amp;#x20;   å‚æ•°:&amp;#x20;   input\\_pdf (str): è¾“å…¥PDFæ–‡ä»¶è·¯å¾„&amp;#x20;   output\\_pdf (str): è¾“å‡ºPDFæ–‡ä»¶è·¯å¾„&amp;#x20;   font\\_size (float): æ°´å°å­—ä½“å¤§å°&amp;#x20;   rotation\\_angle (float): æ°´å°æ—‹è½¬è§’åº¦ (åº¦)&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   doc = fitz.open(input\\_pdf)&amp;#x20;   for page in doc:&amp;#x20;       \\# è·å–é¡µé¢ä¸Šçš„æ‰€æœ‰æ–‡æœ¬å’Œå®ƒä»¬çš„å±æ€§&amp;#x20;       text\\_infos = page.get\\_text(&quot;dict&quot;)&amp;#x20;       for block in text\\_infos\\[&quot;blocks&quot;]:&amp;#x20;           if &quot;lines&quot; in block:&amp;#x20;               for line in block\\[&quot;lines&quot;]:&amp;#x20;                   for span in line\\[&quot;spans&quot;]:&amp;#x20;                       \\# æå–å­—ä½“å¤§å°å’Œæ—‹è½¬è§’åº¦&amp;#x20;                       current\\_size = span\\[&quot;size&quot;]&amp;#x20;                       \\# è®¡ç®—æ—‹è½¬è§’åº¦ (PyMuPDFä¸­é€šè¿‡å˜æ¢çŸ©é˜µè®¡ç®—)&amp;#x20;                       matrix = fitz.Matrix(span\\[&quot;matrix&quot;])&amp;#x20;                       \\# matrix.decompose() è¿”å› (a, b, c, d, e, f)&amp;#x20;                       \\# æ—‹è½¬è§’åº¦é€šè¿‡ atan2(b, a) æˆ– atan2(-c, d) è®¡ç®—ã€‚&amp;#x20;                       \\# å¯¹äºç®€å•çš„æ—‹è½¬ï¼Œalpha å’Œ beta åº”è¯¥è¿‘ä¼¼ç›¸ç­‰æˆ–äº’è¡¥ã€‚&amp;#x20;                       \\# è¿™é‡Œæˆ‘ä»¬ç®€åŒ–ï¼Œç›´æ¥ä½¿ç”¨ atan2(matrix.b, matrix.a) è½¬æ¢æˆè§’åº¦&amp;#x20;                       import math&amp;#x20;                       current\\_rotation = math.degrees(math.atan2(matrix.b, matrix.a))&amp;#x20;                       \\# æ£€æŸ¥æ˜¯å¦åŒ¹é…æ°´å°ç‰¹å¾ï¼Œå¹¶å…è®¸ä¸€å®šçš„è¯¯å·®&amp;#x20;                       if (abs(current\\_size - font\\_size) &lt; 1.5 and # å…è®¸è½»å¾®è¯¯å·®&amp;#x20;                           abs(current\\_rotation - rotation\\_angle) &lt; 5.0): # å…è®¸5åº¦è¯¯å·®&amp;#x20;                           \\# åˆ›å»ºä¸€ä¸ªçŸ©å½¢åŒºåŸŸç”¨äºè¦†ç›–æ°´å°&amp;#x20;                           page.add\\_redact\\_annot(fitz.Rect(span\\[&quot;bbox&quot;]), text=&quot;&quot;)&amp;#x20;       \\# åº”ç”¨æ‰€æœ‰ç¼–è¾‘&amp;#x20;       page.apply\\_redactions()&amp;#x20;   \\# ä¿å­˜ä¿®æ”¹åçš„PDF&amp;#x20;   doc.save(output\\_pdf)&amp;#x20;   doc.close()\n\nä»£ç è§£æï¼š\n\næˆ‘ä»¬ä½¿ç”¨ page.get_text(&quot;dict&quot;) è·å–é¡µé¢ä¸Šæ‰€æœ‰çš„æ–‡æœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„å„ç§å±æ€§ã€‚\n\nä»æ–‡æœ¬è·¨åº¦ (span) ä¸­æå– å­—ä½“å¤§å° å’Œ å˜æ¢çŸ©é˜µã€‚\n\né€šè¿‡åˆ†è§£å˜æ¢çŸ©é˜µæ¥è®¡ç®—æ–‡æœ¬çš„ æ—‹è½¬è§’åº¦ã€‚è¿™é‡Œä½¿ç”¨äº† math.atan2(matrix.b, matrix.a) æ¥æ›´å‡†ç¡®åœ°è·å–æ—‹è½¬è§’åº¦ã€‚\n\nå°†æå–åˆ°çš„ç‰¹å¾ä¸ä½ å·²çŸ¥çš„æ°´å°ç‰¹å¾è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœåŒ¹é…ï¼ˆå¹¶å…è®¸ä¸€å®šçš„è¯¯å·®èŒƒå›´ï¼‰ï¼Œå°±ç”¨ä¸€ä¸ªç©ºç™½çŸ©å½¢è¦†ç›–æ°´å°åŒºåŸŸã€‚\n\n\néš¾æ˜“åº¦ï¼šâ˜…â˜…â˜…â˜†â˜†\nä¼˜ç‚¹ï¼š å¯¹å…·æœ‰å›ºå®šå­—ä½“å¤§å°å’Œå€¾æ–œè§’åº¦çš„æ°´å°æ•ˆæœç‰¹åˆ«å¥½ï¼Œè¯¯åˆ¤ç‡ä½ã€‚\nç¼ºç‚¹ï¼š éœ€è¦ä½ é¢„å…ˆçŸ¥é“æ°´å°çš„å­—ä½“å¤§å°å’Œæ—‹è½¬è§’åº¦å‚æ•°ã€‚\næ–¹æ³•äºŒï¼šåŸºäºé€æ˜åº¦å’Œé¢œè‰²çš„æ°´å°è¯†åˆ«&#xA;è¿™ç§æ–¹æ³•é€‚ç”¨äºé‚£äº›æœ‰å›ºå®šé€æ˜åº¦å’Œé¢œè‰²çš„æ°´å°ï¼Œç‰¹åˆ«æ˜¯åŠé€æ˜çš„æµ…è‰²æ°´å°ã€‚\nimport fitzdef remove\\_watermark\\_by\\_opacity\\_and\\_color(input\\_pdf, output\\_pdf, opacity\\_threshold, color\\_rgb\\_target, color\\_tolerance=10):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   æ ¹æ®é€æ˜åº¦å’Œé¢œè‰²å»é™¤PDFä¸­çš„æ°´å°ã€‚&amp;#x20;   å‚æ•°:&amp;#x20;   input\\_pdf (str): è¾“å…¥PDFæ–‡ä»¶è·¯å¾„&amp;#x20;   output\\_pdf (str): è¾“å‡ºPDFæ–‡ä»¶è·¯å¾„&amp;#x20;   opacity\\_threshold (float): æ°´å°é€æ˜åº¦é˜ˆå€¼ (0.0-1.0)ï¼Œä½äºæ­¤å€¼å¯èƒ½è®¤ä¸ºæ˜¯æ°´å°&amp;#x20;   color\\_rgb\\_target (tuple): æ°´å°é¢œè‰²çš„RGBå€¼ï¼Œå¦‚ (200, 200, 200)&amp;#x20;   color\\_tolerance (int): é¢œè‰²åŒ¹é…çš„å®¹å·®èŒƒå›´ (0-255)&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   doc = fitz.open(input\\_pdf)&amp;#x20;   for page in doc:&amp;#x20;       \\# è·å–é¡µé¢ä¸Šæ‰€æœ‰çš„ç»˜å›¾æŒ‡ä»¤&amp;#x20;       \\# PyMuPDF ç›´æ¥ä»get\\_text(&quot;dict&quot;)è·å–çš„spané‡Œæ²¡æœ‰é€æ˜åº¦ä¿¡æ¯ï¼Œ&amp;#x20;       \\# é€æ˜åº¦é€šå¸¸æ˜¯åœ¨å›¾å½¢çŠ¶æ€(graphics state)ä¸­è®¾ç½®çš„ï¼Œéœ€è¦è§£æPDFå†…å®¹æµæ‰èƒ½è·å–ã€‚&amp;#x20;       \\# è¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬å‡è®¾é€æ˜åº¦ä¿¡æ¯å¯ä»¥é€šè¿‡æ›´å¤æ‚çš„è§£æè·å¾—ï¼Œ&amp;#x20;       \\# æˆ–è€…é€šè¿‡å›¾åƒæ¸²æŸ“ååˆ†æåƒç´ æ¥å®ç°ã€‚&amp;#x20;       \\# ç®€åŒ–å¤„ç†ï¼šå¯¹äºæ–‡æœ¬æ°´å°ï¼Œé€šå¸¸é¢œè‰²å’Œä½ç½®æ˜¯æ›´å¯é çš„ç‰¹å¾ã€‚&amp;#x20;       \\# å¦‚æœéœ€è¦ç²¾ç¡®çš„é€æ˜åº¦è¯†åˆ«ï¼Œéœ€è¦æ›´æ·±å…¥çš„PDFå†…å®¹æµè§£æã€‚&amp;#x20;       \\# éå†é¡µé¢ä¸Šçš„æ‰€æœ‰æ–‡æœ¬&amp;#x20;       text\\_infos = page.get\\_text(&quot;dict&quot;)&amp;#x20;       for block in text\\_infos\\[&quot;blocks&quot;]:&amp;#x20;           if &quot;lines&quot; in block:&amp;#x20;               for line in block\\[&quot;lines&quot;]:&amp;#x20;                   for span in line\\[&quot;spans&quot;]:&amp;#x20;                       \\# æå–é¢œè‰²ä¿¡æ¯&amp;#x20;                       color\\_int = span\\[&quot;color&quot;]&amp;#x20;                       r = (color\\_int &gt;&gt; 16) &amp; 0xFF&amp;#x20;                       g = (color\\_int &gt;&gt; 8) &amp; 0xFF&amp;#x20;                       b = color\\_int &amp; 0xFF&amp;#x20;                       current\\_color\\_rgb = (r, g, b)&amp;#x20;                       \\# åœ¨PyMuPDFçš„æ–‡æœ¬spanä¿¡æ¯ä¸­ç›´æ¥è·å–é€æ˜åº¦æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œ&amp;#x20;                       \\# å› ä¸ºé€æ˜åº¦æ˜¯å›¾å½¢çŠ¶æ€çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ–‡æœ¬æœ¬èº«çš„ä¸€ä¸ªå±æ€§ã€‚&amp;#x20;                       \\# å¯¹äºçœŸæ­£çš„é€æ˜åº¦åŒ¹é…ï¼Œé€šå¸¸éœ€è¦æ¸²æŸ“é¡µé¢å¹¶åˆ†æåƒç´ çš„alphaé€šé“ï¼Œ&amp;#x20;                       \\# æˆ–è€…è§£ææ›´åº•å±‚çš„PDFå†…å®¹æµã€‚&amp;#x20;                       \\# ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç®€åŒ–ï¼Œå‡è®¾æ‰€æœ‰æ–‡æœ¬éƒ½æ˜¯ä¸é€æ˜çš„ï¼Œ&amp;#x20;                       \\# é™¤éé€šè¿‡å…¶ä»–æ–¹å¼ç¡®è®¤å…¶é€æ˜åº¦ã€‚&amp;#x20;                       \\# å¦‚æœ watermark æ˜¯å›¾åƒï¼Œåˆ™éœ€è¦ç”¨å…¶ä»–æ–¹æ³•å¤„ç†ã€‚&amp;#x20;                       \\# åˆ¤æ–­é¢œè‰²æ˜¯å¦åŒ¹é…ç›®æ ‡é¢œè‰²ï¼ˆå¸¦å®¹å·®ï¼‰&amp;#x20;                       color\\_match = (&amp;#x20;                           abs(current\\_color\\_rgb\\[0] - color\\_rgb\\_target\\[0]) &lt;= color\\_tolerance and&amp;#x20;                           abs(current\\_color\\_rgb\\[1] - color\\_rgb\\_target\\[1]) &lt;= color\\_tolerance and&amp;#x20;                           abs(current\\_color\\_rgb\\[2] - color\\_rgb\\_target\\[2]) &lt;= color\\_tolerance&amp;#x20;                       )&amp;#x20;                       \\# è¿™é‡Œæ²¡æœ‰é€æ˜åº¦ä¿¡æ¯ï¼Œæ‰€ä»¥æš‚æ—¶ä¸ä½œä¸ºåˆ¤æ–­æ¡ä»¶&amp;#x20;                       \\# å¦‚æœä½ çš„æ°´å°æ˜¯æ–‡æœ¬ä¸”é¢œè‰²å›ºå®šï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå¾ˆæœ‰ç”¨&amp;#x20;                       if color\\_match: # ä»…åŸºäºé¢œè‰²åŒ¹é…&amp;#x20;                           page.add\\_redact\\_annot(fitz.Rect(span\\[&quot;bbox&quot;]), text=&quot;&quot;)&amp;#x20;      &amp;#x20;&amp;#x20;       \\# åº”ç”¨æ‰€æœ‰ç¼–è¾‘&amp;#x20;       page.apply\\_redactions()&amp;#x20;   \\# ä¿å­˜ä¿®æ”¹åçš„PDF&amp;#x20;   doc.save(output\\_pdf)&amp;#x20;   doc.close()\n\nä»£ç è§£æï¼š\n\næˆ‘ä»¬ä»æ–‡æœ¬è·¨åº¦ä¸­æå– RGB é¢œè‰²å€¼ã€‚\n\næ³¨æ„ï¼š ç›´æ¥ä» span ä¸­æå–é€æ˜åº¦ä¿¡æ¯åœ¨ PyMuPDF ä¸­æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºå®ƒé€šå¸¸æ˜¯ PDF å†…å®¹æµä¸­çš„å›¾å½¢çŠ¶æ€å‚æ•°ã€‚ä¸ºäº†å®ç°çœŸæ­£çš„é€æ˜åº¦è¯†åˆ«ï¼Œä½ å¯èƒ½éœ€è¦æ¸²æŸ“é¡µé¢ä¸ºå›¾åƒååˆ†æåƒç´ çš„ alpha é€šé“ï¼Œæˆ–è€…è¿›è¡Œæ›´å¤æ‚çš„ PDF å†…å®¹æµè§£æã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘æš‚æ—¶ç§»é™¤äº†é€æ˜åº¦çš„åˆ¤æ–­ï¼Œä¸»è¦ä¾èµ–é¢œè‰²åŒ¹é…ã€‚\n\næ¯”è¾ƒæå–çš„é¢œè‰²ä¸å·²çŸ¥æ°´å°ç‰¹å¾ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªå®¹å·®èŒƒå›´ã€‚\n\n\néš¾æ˜“åº¦ï¼šâ˜…â˜…â˜…â˜…â˜†\nä¼˜ç‚¹ï¼š å¯¹å…·æœ‰å›ºå®šé¢œè‰²ï¼ˆç‰¹åˆ«æ˜¯æµ…è‰²ï¼‰çš„æ°´å°æ•ˆæœå¥½ã€‚\nç¼ºç‚¹ï¼š é€æ˜åº¦æå–æ˜¯éš¾ç‚¹ï¼Œå¯èƒ½éœ€è¦æ·±å…¥è§£æ PDF å†…éƒ¨ç»“æ„æˆ–å€ŸåŠ©å›¾åƒå¤„ç†åº“ã€‚\næ–¹æ³•ä¸‰ï¼šç»¼åˆå¤šç‰¹å¾çš„æ°´å°è¯†åˆ«&#xA;å½“æ°´å°ç‰¹å¾æ˜ç¡®ä¸”å›ºå®šæ—¶ï¼Œè¿™ä¸ªæ–¹æ³•èƒ½æä¾›æœ€é«˜çš„è¯†åˆ«å‡†ç¡®æ€§ï¼Œå› ä¸ºå®ƒç»“åˆäº†å¤šç§ç‰¹å¾è¿›è¡Œåˆ¤æ–­ã€‚\nimport fitzimport mathdef remove\\_watermark\\_by\\_multiple\\_features(input\\_pdf, output\\_pdf,&amp;#x20;                                         font\\_size, rotation\\_angle,&amp;#x20;                                         color\\_rgb,&amp;#x20;                                         size\\_tolerance=1.5, rotation\\_tolerance=5.0, color\\_tolerance=10):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   æ ¹æ®å¤šç§ç‰¹å¾ç»„åˆå»é™¤PDFä¸­çš„æ°´å°ã€‚&amp;#x20;   ä¸åŒ…å«é€æ˜åº¦å‚æ•°ï¼Œå› ä¸ºç›´æ¥ä»text spanè·å–é€æ˜åº¦å¤æ‚ã€‚&amp;#x20;   å‚æ•°:&amp;#x20;   input\\_pdf (str): è¾“å…¥PDFæ–‡ä»¶è·¯å¾„&amp;#x20;   output\\_pdf (str): è¾“å‡ºPDFæ–‡ä»¶è·¯å¾„&amp;#x20;   font\\_size (float): æ°´å°å­—ä½“å¤§å°&amp;#x20;   rotation\\_angle (float): æ°´å°æ—‹è½¬è§’åº¦ (åº¦)&amp;#x20;   color\\_rgb (tuple): æ°´å°é¢œè‰²çš„RGBå€¼ï¼Œå¦‚ (200, 200, 200)&amp;#x20;   size\\_tolerance (float): å­—ä½“å¤§å°åŒ¹é…çš„å®¹å·®&amp;#x20;   rotation\\_tolerance (float): æ—‹è½¬è§’åº¦åŒ¹é…çš„å®¹å·® (åº¦)&amp;#x20;   color\\_tolerance (int): é¢œè‰²åŒ¹é…çš„å®¹å·® (0-255)&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   doc = fitz.open(input\\_pdf)&amp;#x20;   for page in doc:&amp;#x20;       \\# è·å–é¡µé¢ä¸Šçš„æ‰€æœ‰æ–‡æœ¬å’Œå®ƒä»¬çš„å±æ€§&amp;#x20;       text\\_infos = page.get\\_text(&quot;dict&quot;)&amp;#x20;       for block in text\\_infos\\[&quot;blocks&quot;]:&amp;#x20;           if &quot;lines&quot; in block:&amp;#x20;               for line in block\\[&quot;lines&quot;]:&amp;#x20;                   for span in line\\[&quot;spans&quot;]:&amp;#x20;                       \\# æå–å­—ä½“å¤§å°&amp;#x20;                       current\\_size = span\\[&quot;size&quot;]&amp;#x20;                       \\# è®¡ç®—æ—‹è½¬è§’åº¦&amp;#x20;                       matrix = fitz.Matrix(span\\[&quot;matrix&quot;])&amp;#x20;                       current\\_rotation = math.degrees(math.atan2(matrix.b, matrix.a))&amp;#x20;                       \\# æå–é¢œè‰²ä¿¡æ¯&amp;#x20;                       color\\_int = span\\[&quot;color&quot;]&amp;#x20;                       r = (color\\_int &gt;&gt; 16) &amp; 0xFF&amp;#x20;                       g = (color\\_int &gt;&gt; 8) &amp; 0xFF&amp;#x20;                       b = (color\\_int) &amp; 0xFF&amp;#x20;                       current\\_color\\_rgb = (r, g, b)&amp;#x20;                       \\# ç»¼åˆå¤šä¸ªç‰¹å¾è¿›è¡ŒåŒ¹é…&amp;#x20;                       size\\_match = abs(current\\_size - font\\_size) &lt; size\\_tolerance&amp;#x20;                       rotation\\_match = abs(current\\_rotation - rotation\\_angle) &lt; rotation\\_tolerance&amp;#x20;                       color\\_match = (&amp;#x20;                           abs(current\\_color\\_rgb\\[0] - color\\_rgb\\[0]) &lt;= color\\_tolerance and&amp;#x20;                           abs(current\\_color\\_rgb\\[1] - color\\_rgb\\[1]) &lt;= color\\_tolerance and&amp;#x20;                           abs(current\\_color\\_rgb\\[2] - color\\_rgb\\[2]) &lt;= color\\_tolerance&amp;#x20;                       )&amp;#x20;                       \\# å¦‚æœæ‰€æœ‰ç‰¹å¾éƒ½åŒ¹é…ï¼Œåˆ™è®¤ä¸ºæ˜¯æ°´å°&amp;#x20;                       if size\\_match and rotation\\_match and color\\_match:&amp;#x20;                           \\# åˆ›å»ºä¸€ä¸ªçŸ©å½¢åŒºåŸŸç”¨äºè¦†ç›–æ°´å°&amp;#x20;                           page.add\\_redact\\_annot(fitz.Rect(span\\[&quot;bbox&quot;]), text=&quot;&quot;)&amp;#x20;       \\# åº”ç”¨æ‰€æœ‰ç¼–è¾‘&amp;#x20;       page.apply\\_redactions()&amp;#x20;   \\# ä¿å­˜ä¿®æ”¹åçš„PDF&amp;#x20;   doc.save(output\\_pdf)&amp;#x20;   doc.close()\n\nä»£ç è§£æï¼š\n\nç»¼åˆæå–å­—ä½“å¤§å°ã€æ—‹è½¬è§’åº¦å’Œé¢œè‰²ä¸‰ä¸ªç‰¹å¾ï¼ˆä¸ºäº†ç®€åŒ–å’Œå®ç”¨æ€§ï¼Œç§»é™¤äº†ç›´æ¥åœ¨ span ä¸­è·å–çš„é€æ˜åº¦åˆ¤æ–­ï¼‰ã€‚\n\nè®¾ç½®äº†åˆç†çš„åŒ¹é…å®¹å·®èŒƒå›´ï¼Œä½ å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´è¿™äº›å®¹å·®å€¼ã€‚\n\nåªæœ‰å½“æ‰€æœ‰é€‰å®šçš„ç‰¹å¾éƒ½åŒ¹é…æ—¶æ‰åˆ¤å®šä¸ºæ°´å°ï¼Œè¿™å¤§å¤§æé«˜äº†è¯†åˆ«çš„å‡†ç¡®æ€§ã€‚\n\n\néš¾æ˜“åº¦ï¼šâ˜…â˜…â˜…â˜…â˜…\nä¼˜ç‚¹ï¼š è¯†åˆ«å‡†ç¡®æ€§é«˜ï¼Œè¯¯åˆ¤ç‡æä½ã€‚\nç¼ºç‚¹ï¼š å®ç°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç²¾ç¡®çš„æ°´å°ç‰¹å¾å‚æ•°ã€‚\næ–¹æ³•å››ï¼šåŸºäºæ–‡æœ¬ç‰¹å¾çš„ç›´æ¥åˆ é™¤æ³•&#xA;å¦‚æœä½ çŸ¥é“æ°´å°çš„å…·ä½“æ–‡æœ¬å†…å®¹ï¼Œæˆ–è€…å¯ä»¥é€šè¿‡ä¸€äº›ç®€å•çš„æ–‡æœ¬å±æ€§æ¥è¯†åˆ«ï¼Œè¿™ä¸ªæ–¹æ³•æœ€ç›´æ¥ã€æœ€å¿«é€Ÿã€‚\nimport fitzdef is\\_watermark\\_span(span, target\\_text=None, min\\_size=None, max\\_size=None, target\\_color\\_rgb=None, color\\_tolerance=10):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   åˆ¤æ–­æ–‡æœ¬è·¨åº¦æ˜¯å¦ä¸ºæ°´å°ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè‡ªå®šä¹‰åˆ¤æ–­æ¡ä»¶ã€‚&amp;#x20;   å‚æ•°:&amp;#x20;   span (dict): æ–‡æœ¬è·¨åº¦å­—å…¸&amp;#x20;   target\\_text (str): å¯é€‰ï¼Œè¦åŒ¹é…çš„æ°´å°æ–‡æœ¬å†…å®¹&amp;#x20;   min\\_size (float): å¯é€‰ï¼Œæ°´å°å­—ä½“æœ€å°å°ºå¯¸&amp;#x20;   max\\_size (float): å¯é€‰ï¼Œæ°´å°å­—ä½“æœ€å¤§å°ºå¯¸&amp;#x20;   target\\_color\\_rgb (tuple): å¯é€‰ï¼Œæ°´å°é¢œè‰²çš„RGBå€¼&amp;#x20;   color\\_tolerance (int): é¢œè‰²åŒ¹é…çš„å®¹å·® (0-255)&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   \\# ç¤ºä¾‹ï¼šåˆ¤æ–­å­—ä½“å¤§å°ã€é¢œè‰²ç­‰ç‰¹å¾&amp;#x20;   \\# å¯ä»¥æ ¹æ®å®é™…æƒ…å†µç»„åˆå¤šä¸ªæ¡ä»¶&amp;#x20;  &amp;#x20;&amp;#x20;   \\# å­—ä½“å¤§å°åˆ¤æ–­&amp;#x20;   size\\_match = True&amp;#x20;   if min\\_size is not None and span\\[&quot;size&quot;] &lt; min\\_size:&amp;#x20;       size\\_match = False&amp;#x20;   if max\\_size is not None and span\\[&quot;size&quot;] &gt; max\\_size:&amp;#x20;       size\\_match = False&amp;#x20;   \\# æ–‡æœ¬å†…å®¹åˆ¤æ–­&amp;#x20;   text\\_match = True&amp;#x20;   if target\\_text is not None and target\\_text.lower() not in span\\[&quot;text&quot;].lower():&amp;#x20;       text\\_match = False&amp;#x20;  &amp;#x20;&amp;#x20;   \\# é¢œè‰²åˆ¤æ–­&amp;#x20;   color\\_match = True&amp;#x20;   if target\\_color\\_rgb is not None:&amp;#x20;       color\\_int = span\\[&quot;color&quot;]&amp;#x20;       r = (color\\_int &gt;&gt; 16) &amp; 0xFF&amp;#x20;       g = (color\\_int &gt;&gt; 8) &amp; 0xFF&amp;#x20;       b = color\\_int &amp; 0xFF&amp;#x20;       current\\_color\\_rgb = (r, g, b)&amp;#x20;      &amp;#x20;&amp;#x20;       if not (abs(current\\_color\\_rgb\\[0] - target\\_color\\_rgb\\[0]) &lt;= color\\_tolerance and&amp;#x20;               abs(current\\_color\\_rgb\\[1] - target\\_color\\_rgb\\[1]) &lt;= color\\_tolerance and&amp;#x20;               abs(current\\_color\\_rgb\\[2] - target\\_color\\_rgb\\[2]) &lt;= color\\_tolerance):&amp;#x20;           color\\_match = False&amp;#x20;   return size\\_match and text\\_match and color\\_matchdef remove\\_watermark\\_by\\_text\\_features(doc\\_path, output\\_path, \\*\\*kwargs):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   æ ¹æ®æ–‡æœ¬ç‰¹å¾å»é™¤PDFä¸­çš„æ°´å°ã€‚&amp;#x20;   å‚æ•°:&amp;#x20;   doc\\_path (str): è¾“å…¥PDFæ–‡ä»¶è·¯å¾„&amp;#x20;   output\\_path (str): è¾“å‡ºPDFæ–‡ä»¶è·¯å¾„&amp;#x20;   \\*\\*kwargs: ä¼ é€’ç»™ is\\_watermark\\_span å‡½æ•°çš„å‚æ•°ï¼Œå¦‚ target\\_text, min\\_size, max\\_size, target\\_color\\_rgb&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   doc = fitz.open(doc\\_path)&amp;#x20;   for page in doc:&amp;#x20;       \\# æœç´¢ç¬¦åˆæ°´å°ç‰¹å¾çš„æ–‡æœ¬&amp;#x20;       for block in page.get\\_text(&quot;dict&quot;)\\[&quot;blocks&quot;]:&amp;#x20;           if block\\[&quot;type&quot;] == 0:  # æ–‡æœ¬å—&amp;#x20;               for line in block\\[&quot;lines&quot;]:&amp;#x20;                   for span in line\\[&quot;spans&quot;]:&amp;#x20;                       if is\\_watermark\\_span(span,\\*\\* kwargs):  # è‡ªå®šä¹‰åˆ¤æ–­å‡½æ•°&amp;#x20;                           page.add\\_redact\\_annot(span\\[&quot;bbox&quot;])&amp;#x20;       page.apply\\_redactions()&amp;#x20;   doc.save(output\\_path)&amp;#x20;   doc.close()\\# ç¤ºä¾‹ç”¨æ³•\\# remove\\_watermark\\_by\\_text\\_features(&quot;input.pdf&quot;, &quot;output.pdf&quot;, target\\_text=&quot;CONFIDENTIAL&quot;, min\\_size=10, max\\_size=14, target\\_color\\_rgb=(204, 204, 204))\n\nä»£ç è§£æï¼š\n\né€šè¿‡ä¸€ä¸ªå¯è‡ªå®šä¹‰çš„ is_watermark_span å‡½æ•°ç›´æ¥æœç´¢ç¬¦åˆç‰¹å®šæ–‡æœ¬ç‰¹å¾çš„æ°´å°å†…å®¹ã€‚\n\nä½ å¯ä»¥ä¼ å…¥ target_textã€min_sizeã€max_size å’Œ target_color_rgb ç­‰å‚æ•°æ¥ç²¾ç¡®å®šä¹‰æ°´å°çš„ç‰¹å¾ã€‚\n\nå¯¹åˆ¤å®šä¸ºæ°´å°çš„æ–‡æœ¬è¿›è¡Œè¦†ç›–å¤„ç†ã€‚\n\n\néš¾æ˜“åº¦ï¼šâ˜…â˜…â˜†â˜†â˜†\nä¼˜ç‚¹ï¼š å®ç°ç®€å•ï¼Œå¤„ç†é€Ÿåº¦å¿«ï¼Œéå¸¸é€‚åˆå¤„ç†ç®€å•çš„æ–‡æœ¬æ°´å°ã€‚\nç¼ºç‚¹ï¼š ä»…é€‚ç”¨äºæ–‡æœ¬æ°´å°ï¼Œæ— æ³•å¤„ç†å›¾åƒæ°´å°ã€‚\næ–¹æ³•äº”ï¼šåŸºäºæ··åˆç‰¹å¾çš„é«˜çº§è¯†åˆ«æ³•&#xA;å¯¹äºæ›´å¤æ‚çš„ PDF æ°´å°ï¼ˆä¾‹å¦‚åŒ…å«æ–‡æœ¬å’Œå›¾åƒï¼‰ï¼Œè¿™ç§æ–¹æ³•ç»“åˆäº†æ–‡æœ¬å’Œå›¾åƒç‰¹å¾è¯†åˆ«ï¼Œèƒ½å¤Ÿæä¾›æ›´é«˜çš„è¯†åˆ«ç²¾åº¦ã€‚è¯·æ³¨æ„ï¼Œå›¾åƒå¤„ç†éƒ¨åˆ†éœ€è¦ numpy å’Œ opencv-python åº“ã€‚\nimport fitzimport numpy as npimport cv2\\# Placeholder for actual watermark text detection logicdef is\\_watermark\\_text(span):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   åˆ¤æ–­æ–‡æœ¬è·¨åº¦æ˜¯å¦ä¸ºæ°´å°ã€‚&amp;#x20;   ä½ å¯ä»¥æ ¹æ®å®é™…æƒ…å†µåœ¨è¿™é‡Œå®ç°æ›´å¤æ‚çš„æ–‡æœ¬æ°´å°åˆ¤æ–­é€»è¾‘ï¼Œ&amp;#x20;   ä¾‹å¦‚åŸºäºå­—ä½“ã€é¢œè‰²ã€å¤§å°ã€ä½ç½®ã€é‡å¤æ€§ç­‰ã€‚&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   \\# ç¤ºä¾‹ï¼šå‡è®¾æ‰€æœ‰æ»¡è¶³ç‰¹å®šå°ºå¯¸å’Œé¢œè‰²çš„æ–‡æœ¬éƒ½æ˜¯æ°´å°&amp;#x20;   \\# çœŸå®åº”ç”¨ä¸­ï¼Œä½ éœ€è¦æ›´ç²¾ç¡®çš„é€»è¾‘&amp;#x20;   color\\_int = span\\[&quot;color&quot;]&amp;#x20;   r = (color\\_int &gt;&gt; 16) &amp; 0xFF&amp;#x20;   g = (color\\_int &gt;&gt; 8) &amp; 0xFF&amp;#x20;   b = color\\_int &amp; 0xFF&amp;#x20;  &amp;#x20;&amp;#x20;   \\# å‡è®¾æ°´å°æ˜¯æµ…ç°è‰²ï¼Œå­—ä½“è¾ƒå¤§&amp;#x20;   if (100 &lt;= r &lt;= 220 and 100 &lt;= g &lt;= 220 and 100 &lt;= b &lt;= 220) and span\\[&quot;size&quot;] &gt; 15:&amp;#x20;       return True&amp;#x20;   return Falsedef process\\_watermark\\_regions(page, text\\_spans\\_to\\_redact, image\\_regions\\_to\\_redact):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   å¤„ç†è¯†åˆ«åˆ°çš„æ°´å°åŒºåŸŸã€‚&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   \\# å¯¹æ–‡æœ¬æ°´å°åŒºåŸŸè¿›è¡Œå¤„ç†&amp;#x20;   for span\\_bbox in text\\_spans\\_to\\_redact:&amp;#x20;       page.add\\_redact\\_annot(fitz.Rect(span\\_bbox))&amp;#x20;   \\# å¯¹å›¾åƒæ°´å°åŒºåŸŸè¿›è¡Œå¤„ç†&amp;#x20;   for region\\_bbox in image\\_regions\\_to\\_redact:&amp;#x20;       page.add\\_redact\\_annot(fitz.Rect(region\\_bbox))&amp;#x20;   page.apply\\_redactions()def advanced\\_watermark\\_removal(doc\\_path, output\\_path, watermark\\_template\\_path=None):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   æ ¹æ®æ··åˆç‰¹å¾ï¼ˆæ–‡æœ¬å’Œå›¾åƒï¼‰å»é™¤PDFä¸­çš„æ°´å°ã€‚&amp;#x20;   å‚æ•°:&amp;#x20;   doc\\_path (str): è¾“å…¥PDFæ–‡ä»¶è·¯å¾„&amp;#x20;   output\\_path (str): è¾“å‡ºPDFæ–‡ä»¶è·¯å¾„&amp;#x20;   watermark\\_template\\_path (str): å¯é€‰ï¼Œæ°´å°å›¾åƒæ¨¡æ¿çš„è·¯å¾„ï¼Œç”¨äºSIFTç‰¹å¾åŒ¹é…ã€‚&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   doc = fitz.open(doc\\_path)&amp;#x20;  &amp;#x20;&amp;#x20;   watermark\\_template = None&amp;#x20;   if watermark\\_template\\_path:&amp;#x20;       \\# Load watermark template in grayscale for SIFT&amp;#x20;       watermark\\_template = cv2.imread(watermark\\_template\\_path, cv2.IMREAD\\_GRAYSCALE)&amp;#x20;       if watermark\\_template is None:&amp;#x20;           print(f&quot;è­¦å‘Šï¼šæ— æ³•åŠ è½½æ°´å°æ¨¡æ¿å›¾åƒï¼š&#123;watermark\\_template\\_path&#125;&quot;)&amp;#x20;           watermark\\_template\\_path = None # Disable image matching if template fails to load&amp;#x20;   sift = cv2.SIFT\\_create()&amp;#x20;   kp1, des1 = None, None&amp;#x20;   if watermark\\_template\\_path and watermark\\_template is not None:&amp;#x20;       kp1, des1 = sift.detectAndCompute(watermark\\_template, None)&amp;#x20;  &amp;#x20;&amp;#x20;   for page in doc:&amp;#x20;       text\\_spans\\_to\\_redact = \\[]&amp;#x20;       image\\_regions\\_to\\_redact = \\[]&amp;#x20;       \\# ç¬¬ä¸€æ­¥ï¼šæ–‡æœ¬ç‰¹å¾è¯†åˆ«&amp;#x20;       text\\_infos = page.get\\_text(&quot;dict&quot;)&amp;#x20;       for block in text\\_infos\\[&quot;blocks&quot;]:&amp;#x20;           if &quot;lines&quot; in block:&amp;#x20;               for line in block\\[&quot;lines&quot;]:&amp;#x20;                   for span in line\\[&quot;spans&quot;]:&amp;#x20;                       if is\\_watermark\\_text(span): # æ£€æŸ¥å­—ä½“/é¢œè‰²ç­‰&amp;#x20;                           text\\_spans\\_to\\_redact.append(span\\[&quot;bbox&quot;])&amp;#x20;      &amp;#x20;&amp;#x20;       \\# ç¬¬äºŒæ­¥ï¼šå›¾åƒç‰¹å¾è¯†åˆ« (å¦‚æœæä¾›äº†æ°´å°æ¨¡æ¿)&amp;#x20;       if watermark\\_template\\_path and watermark\\_template is not None and des1 is not None:&amp;#x20;           pix = page.get\\_pixmap(matrix=fitz.Matrix(2,2)) # æé«˜æ¸²æŸ“åˆ†è¾¨ç‡ä»¥ä¾¿æ›´å¥½çš„ç‰¹å¾æ£€æµ‹&amp;#x20;           img = cv2.cvtColor(np.frombuffer(pix.samples, np.uint8).reshape(&amp;#x20;               pix.h, pix.w, pix.n), cv2.COLOR\\_RGB2GRAY) # è½¬ä¸ºç°åº¦å›¾è¿›è¡Œç‰¹å¾æ£€æµ‹&amp;#x20;           kp2, des2 = sift.detectAndCompute(img, None)&amp;#x20;           if des2 is not None and len(des1) &gt; 0 and len(des2) &gt; 0:&amp;#x20;               \\# ç‰¹å¾åŒ¹é…&amp;#x20;               matcher = cv2.BFMatcher()&amp;#x20;               matches = matcher.knnMatch(des1, des2, k=2)&amp;#x20;              &amp;#x20;&amp;#x20;               \\# ç­›é€‰è‰¯å¥½çš„åŒ¹é…ç‚¹&amp;#x20;               good\\_matches = \\[]&amp;#x20;               for m, n in matches:&amp;#x20;                   if m.distance &lt; 0.75 \\* n.distance: # 0.75æ˜¯ç»éªŒå€¼ï¼Œå¯è°ƒ&amp;#x20;                       good\\_matches.append(m)&amp;#x20;              &amp;#x20;&amp;#x20;               \\# å¦‚æœåŒ¹é…ç‚¹è¶³å¤Ÿå¤šï¼Œåˆ™è®¤ä¸ºå­˜åœ¨å›¾åƒæ°´å°&amp;#x20;               if len(good\\_matches) &gt; 10: # è‡³å°‘éœ€è¦10ä¸ªå¥½çš„åŒ¹é…ç‚¹&amp;#x20;                   \\# å°è¯•æ‰¾åˆ°æ°´å°åœ¨é¡µé¢ä¸Šçš„å¤§è‡´ä½ç½®&amp;#x20;                   src\\_pts = np.float32(\\[kp1\\[m.queryIdx].pt for m in good\\_matches]).reshape(-1, 1, 2)&amp;#x20;                   dst\\_pts = np.float32(\\[kp2\\[m.trainIdx].pt for m in good\\_matches]).reshape(-1, 1, 2)&amp;#x20;                  &amp;#x20;&amp;#x20;                   \\# ä½¿ç”¨ findHomography æ‰¾åˆ°å˜æ¢çŸ©é˜µ&amp;#x20;                   M, mask = cv2.findHomography(src\\_pts, dst\\_pts, cv2.RANSAC, 5.0)&amp;#x20;                  &amp;#x20;&amp;#x20;                   if M is not None:&amp;#x20;                       h, w = watermark\\_template.shape&amp;#x20;                       pts = np.float32(\\[\\[0, 0], \\[0, h-1], \\[w-1, h-1], \\[w-1, 0]]).reshape(-1, 1, 2)&amp;#x20;                      &amp;#x20;&amp;#x20;                       \\# åº”ç”¨å˜æ¢çŸ©é˜µï¼Œå¾—åˆ°æ°´å°åœ¨é¡µé¢ä¸Šçš„å››ä¸ªè§’ç‚¹&amp;#x20;                       dst = cv2.perspectiveTransform(pts, M)&amp;#x20;                      &amp;#x20;&amp;#x20;                       \\# è®¡ç®—æ°´å°åŒºåŸŸçš„è¾¹ç•Œæ¡†&amp;#x20;                       min\\_x = int(np.min(dst\\[:, 0, 0]) / pix.matrix.a) # è¿˜åŸåˆ°åŸå§‹PDFåæ ‡&amp;#x20;                       min\\_y = int(np.min(dst\\[:, 0, 1]) / pix.matrix.d)&amp;#x20;                       max\\_x = int(np.max(dst\\[:, 0, 0]) / pix.matrix.a)&amp;#x20;                       max\\_y = int(np.max(dst\\[:, 0, 1]) / pix.matrix.d)&amp;#x20;                      &amp;#x20;&amp;#x20;                       image\\_regions\\_to\\_redact.append((min\\_x, min\\_y, max\\_x, max\\_y))&amp;#x20;       \\# ç»¼åˆå¤„ç†æ–‡æœ¬å’Œå›¾åƒæ°´å°&amp;#x20;       process\\_watermark\\_regions(page, text\\_spans\\_to\\_redact, image\\_regions\\_to\\_redact)&amp;#x20;   doc.save(output\\_path)&amp;#x20;   doc.close()\\# ç¤ºä¾‹ç”¨æ³•ï¼ˆéœ€è¦å‡†å¤‡ä¸€ä¸ª watermark\\_template.png å›¾ç‰‡ä½œä¸ºæ°´å°æ¨¡æ¿ï¼‰\\# advanced\\_watermark\\_removal(&quot;input.pdf&quot;, &quot;output.pdf&quot;, &quot;watermark\\_template.png&quot;)\n\nä»£ç è§£æï¼š\n\næ–‡æœ¬ç‰¹å¾è¯†åˆ«ï¼š æ²¿ç”¨äº†ä¹‹å‰ is_watermark_text çš„æ¦‚å¿µï¼Œä½†ä½ éœ€è¦æ ¹æ®å®é™…æ°´å°ç‰¹æ€§æ¥å®Œå–„è¿™ä¸ªé€»è¾‘ã€‚\n\nå›¾åƒç‰¹å¾è¯†åˆ«ï¼š\n\nå°† PDF é¡µé¢æ¸²æŸ“ä¸ºå›¾åƒï¼Œå¹¶è½¬æ¢ä¸ºç°åº¦å›¾ï¼Œä»¥ä¾¿è¿›è¡Œç‰¹å¾æ£€æµ‹ã€‚\n\nä½¿ç”¨ SIFT ç®—æ³•ï¼ˆæˆ–å…¶ä»–ç‰¹å¾åŒ¹é…ç®—æ³•å¦‚ ORB, SURFï¼‰æ¥æ£€æµ‹å¹¶åŒ¹é…å›¾åƒæ°´å°æ¨¡æ¿ã€‚\n\né€šè¿‡ findHomography è®¡ç®—æ°´å°åœ¨é¡µé¢ä¸Šçš„å˜æ¢ï¼Œä»è€Œç¡®å®šæ°´å°çš„ç²¾ç¡®ä½ç½®å’Œè¾¹ç•Œæ¡†ã€‚\n\næ³¨æ„ï¼š å›¾åƒå¤„ç†åº“ (å¦‚ OpenCV) é€šå¸¸åœ¨åƒç´ åæ ‡ç³»ä¸‹æ“ä½œï¼Œä½ éœ€è¦å°†æ£€æµ‹åˆ°çš„åƒç´ åæ ‡è½¬æ¢å› PyMuPDF ä½¿ç”¨çš„ PDF åæ ‡ã€‚\n\n\n\nç»¼åˆå¤„ç†ï¼š å°†æ–‡æœ¬å’Œå›¾åƒè¯†åˆ«çš„ç»“æœç»“åˆèµ·æ¥ï¼Œå¯¹æ‰€æœ‰è¯†åˆ«å‡ºçš„æ°´å°åŒºåŸŸè¿›è¡Œå¤„ç†ã€‚\n\n\néš¾æ˜“åº¦ï¼šâ˜…â˜…â˜…â˜…â˜†\nä¼˜ç‚¹ï¼š è¯†åˆ«ç²¾åº¦é«˜ï¼Œé€‚ç”¨äºå¤æ‚æ°´å°ç¯å¢ƒï¼ˆæ–‡æœ¬ä¸å›¾åƒæ··åˆï¼‰ï¼Œé²æ£’æ€§å¼ºã€‚\nç¼ºç‚¹ï¼š å®ç°å¤æ‚ï¼Œéœ€è¦æ°´å°æ¨¡æ¿ï¼Œå¤„ç†é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œéœ€è¦é¢å¤–çš„å›¾åƒå¤„ç†åº“ã€‚\næ–¹æ³•å…­ï¼šåŸºäº PDF åº•å±‚ç»“æ„çš„ç»ˆææ–¹æ¡ˆ&#xA;è¿™ç§æ–¹æ³•æœ€ä¸ºå½»åº•ï¼Œå› ä¸ºå®ƒç›´æ¥æ“ä½œ PDF æ–‡ä»¶çš„åº•å±‚ç»“æ„ã€‚ä½†å®ƒä¹Ÿè¦æ±‚ä½ å¯¹ PDF è§„èŒƒæœ‰æ·±å…¥çš„äº†è§£ï¼Œæ“ä½œä¸å½“å¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶æŸåã€‚\nimport fitzdef deep\\_watermark\\_removal(doc\\_path, output\\_path):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   é€šè¿‡ç›´æ¥æ“ä½œPDFçš„XObjectå’Œå†…å®¹æµï¼Œå°è¯•å»é™¤æ°´å°ã€‚&amp;#x20;   è¿™æ˜¯ä¸€ç§æ›´åº•å±‚ã€æ›´å½»åº•çš„æ–¹å¼ï¼Œä½†éœ€è¦å¯¹PDFç»“æ„æœ‰ä¸€å®šäº†è§£ã€‚&amp;#x20;   æ³¨æ„ï¼šæ­¤æ–¹æ³•å¯èƒ½éå¸¸å…·ä½“ï¼Œä¸é€‚ç”¨äºæ‰€æœ‰æ°´å°ç±»å‹ï¼Œä¸”æ“ä½œä¸å½“å¯èƒ½æŸåPDFã€‚&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   doc = fitz.open(doc\\_path)&amp;#x20;  &amp;#x20;&amp;#x20;   for page\\_num, page in enumerate(doc):&amp;#x20;       \\# å°è¯•é€šè¿‡åˆ é™¤XObjectï¼ˆå¤–éƒ¨å¯¹è±¡ï¼Œå¯èƒ½æ˜¯å›¾åƒæˆ–Form XObjectï¼‰æ¥å»é™¤æ°´å°&amp;#x20;       \\# è¿™éœ€è¦çŒœæµ‹å“ªäº›XObjectæ˜¯æ°´å°ã€‚é€šå¸¸æ°´å°æ˜¯é€æ˜çš„æˆ–åœ¨åº•å±‚ã€‚&amp;#x20;       \\# PyMuPDFæ²¡æœ‰ç›´æ¥çš„ delete\\_object æ–¹æ³•ï¼Œé€šå¸¸çš„åšæ³•æ˜¯é‡æ–°æ„å»ºå†…å®¹æµæˆ–ç”¨add\\_redact\\_annotã€‚&amp;#x20;       \\# å¦‚æœæ°´å°æ˜¯ä½œä¸ºç‹¬ç«‹XObjectåµŒå…¥çš„ï¼Œä½ å¯ä»¥å°è¯•è¯†åˆ«å¹¶æ›¿æ¢é¡µé¢å†…å®¹æµä¸­å¯¹å®ƒä»¬çš„å¼•ç”¨ã€‚&amp;#x20;       \\# è¿™æ˜¯ä¸€ä¸ªéå¸¸é«˜çº§ä¸”é£é™©é«˜çš„æ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ç›´æ¥ä¿®æ”¹XObjectï¼Œè€Œæ˜¯ä¾èµ–redactionã€‚&amp;#x20;      &amp;#x20;&amp;#x20;       \\# å¦ä¸€ç§æ€è·¯æ˜¯æ£€æŸ¥é¡µé¢å†…å®¹æµä¸­æ˜¯å¦å­˜åœ¨ç‰¹å®šçš„æ“ä½œç¬¦ï¼Œä¾‹å¦‚è®¾ç½®é€æ˜åº¦æˆ–ç‰¹å®šé¢œè‰²ã€‚&amp;#x20;       \\# ä½†è¿™éœ€è¦æ›´æ·±å…¥çš„è§£æå†…å®¹æµã€‚&amp;#x20;      &amp;#x20;&amp;#x20;       \\# ç›®å‰PyMuPDFæ²¡æœ‰ç›´æ¥æš´éœ²ä¿®æ”¹/åˆ é™¤åº•å±‚XObjectçš„APIï¼Œ&amp;#x20;       \\# add\\_redact\\_annot æ˜¯æœ€å®‰å…¨å’Œæ¨èçš„æ–¹å¼æ¥â€œåˆ é™¤â€é¡µé¢å†…å®¹ã€‚&amp;#x20;       \\# å¦‚æœæ°´å°æ˜¯æ–‡æœ¬ï¼Œå¯ä»¥ç»“åˆæ–¹æ³•1-4æ¥è¯†åˆ«ã€‚&amp;#x20;       \\# å¦‚æœæ°´å°æ˜¯å›¾åƒï¼Œä½†ä¸æ˜¯ä½œä¸ºXObjectç›´æ¥æ’å…¥ï¼Œè€Œæ˜¯ä½œä¸ºèƒŒæ™¯ï¼Œåˆ™éœ€è¦æ¸²æŸ“åå¤„ç†ã€‚&amp;#x20;       \\# ç¤ºä¾‹ï¼šå°è¯•æŸ¥æ‰¾å¹¶åˆ é™¤åç§°ä¸­å¯èƒ½åŒ…å«â€œWatermarkâ€çš„Form XObjectå¼•ç”¨&amp;#x20;       \\# è¿™æ˜¯ä¸€ä¸ªè±¡å¾æ€§çš„æ“ä½œï¼Œå®é™…æ“ä½œä¼šå¤æ‚å¾—å¤šã€‚&amp;#x20;      &amp;#x20;&amp;#x20;       \\# è·å–é¡µé¢çš„å†…å®¹æµ&amp;#x20;       \\#contents = page.get\\_contents() # è¿™æ˜¯å†…å®¹æµçš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå¯¹è±¡ID&amp;#x20;       \\#for item\\_id in contents:&amp;#x20;       \\#    item\\_obj = doc.get\\_pdf\\_object(item\\_id) # è·å–å®é™…çš„PDFå¯¹è±¡&amp;#x20;       \\#    if item\\_obj:&amp;#x20;       \\#        content\\_bytes = item\\_obj.read()&amp;#x20;       \\#        # æ£€æŸ¥å†…å®¹æµä¸­æ˜¯å¦æœ‰æ°´å°ç›¸å…³çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚ /DeviceGray Cs, /CA 0.x, /ca 0.x&amp;#x20;       \\#        # è¿™æ˜¯ä¸€ä¸ªé«˜åº¦å®šåˆ¶åŒ–çš„è¿‡ç¨‹ï¼Œå–å†³äºæ°´å°æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„ã€‚&amp;#x20;       \\#        # é€šå¸¸æ°´å°æ–‡æœ¬ä¼šä½¿ç”¨ç‰¹å®šçš„å­—ä½“ã€é¢œè‰²å’Œé€æ˜åº¦è®¾ç½®ã€‚&amp;#x20;       \\#        # æˆ‘ä»¬å¯ä»¥å°è¯•æ›¿æ¢æ‰è¿™äº›è®¾ç½®æˆ–å…¶ç›¸å…³çš„æ–‡æœ¬/å›¾åƒç»˜å›¾æŒ‡ä»¤ã€‚&amp;#x20;       \\#        # ä¾‹å¦‚ï¼Œå¦‚æœæ°´å°è¢«æ ‡è®°ä¸º /Watermarkï¼Œå¯ä»¥å°è¯•ç§»é™¤è¿™ä¸ªæ ‡è®°&amp;#x20;       \\#        # è­¦å‘Šï¼šç›´æ¥ä¿®æ”¹å†…å®¹æµéå¸¸å±é™©ï¼Œå¯èƒ½å¯¼è‡´PDFæŸåã€‚&amp;#x20;       \\#        # content\\_stream = content\\_bytes.replace(b&quot;/Watermark&quot;, b&quot;&quot;)&amp;#x20;       \\#        # å¦‚æœå†…å®¹æµå¯¹è±¡æ˜¯å¯å†™çš„ï¼Œå¯ä»¥å°è¯•æ›´æ–°å®ƒ&amp;#x20;       \\#        # doc.update\\_object(item\\_id, content\\_stream)&amp;#x20;       \\#        pass # å®é™…ä¸æ‰§è¡Œç›´æ¥ä¿®æ”¹ï¼Œè€Œæ˜¯ä½¿ç”¨æ›´å®‰å…¨çš„redaction&amp;#x20;       \\# ç”±äºPyMuPDFæ²¡æœ‰ç›´æ¥åˆ é™¤XObjectçš„ç®€å•APIï¼Œå¹¶ä¸”ç›´æ¥ä¿®æ”¹å†…å®¹æµé£é™©é«˜ï¼Œ&amp;#x20;       \\# è¿™ç§â€œç»ˆææ–¹æ¡ˆâ€é€šå¸¸æŒ‡çš„æ˜¯åœ¨æ›´åº•å±‚çš„PDFè§£æåº“ä¸­å®ç°ã€‚&amp;#x20;       \\# åœ¨PyMuPDFçš„è¯­å¢ƒä¸‹ï¼Œæœ€å®‰å…¨å’Œæ¨èçš„â€œåº•å±‚â€å¤„ç†æ˜¯ä½¿ç”¨ redact\\_annot æ¥è¦†ç›–ã€‚&amp;#x20;       \\# å¦‚æœæ°´å°æ˜¯ä½œä¸º Form XObject åµŒå…¥ï¼Œä¸”å®ƒä»¬æ˜¯åŠé€æ˜çš„ï¼Œ&amp;#x20;       \\# PyMuPDF çš„ page.get\\_text(&quot;dict&quot;) æˆ– page.get\\_images() å¯èƒ½æ— æ³•ç›´æ¥è¯†åˆ«ã€‚&amp;#x20;       \\# æ­¤æ—¶ï¼Œå¯èƒ½éœ€è¦ï¼š&amp;#x20;       \\# 1. éå†é¡µé¢æ‰€æœ‰å¯¹è±¡ï¼ˆPyMuPDFä¸ç›´æ¥æä¾›æ­¤åŠŸèƒ½ï¼Œé™¤éé€šè¿‡é«˜çº§è§£æï¼‰ã€‚&amp;#x20;       \\# 2. æ¸²æŸ“é¡µé¢å¹¶è¿›è¡Œå›¾åƒå¤„ç†ï¼Œè¯†åˆ«æ°´å°åŒºåŸŸï¼Œç„¶åè¿›è¡Œ redactã€‚&amp;#x20;      &amp;#x20;&amp;#x20;       \\# æ€»ç»“ï¼šæ­¤æ–¹æ³•åœ¨PyMuPDFä¸­å®ç°éå¸¸å›°éš¾ä¸”ä¸æ¨èï¼Œé™¤éå¯¹PDFå†…éƒ¨ç»“æ„æœ‰ææ·±ç†è§£ã€‚&amp;#x20;       \\# æ¨èä½¿ç”¨å‰é¢æ›´å®‰å…¨ã€æ›´æ˜“äºæ§åˆ¶çš„åŸºäºç‰¹å¾çš„redactionæ–¹æ³•ã€‚&amp;#x20;       \\# ä¸ºäº†è®©è¿™ä¸ªå‡½æ•°æœ‰å®é™…æ„ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒåœ¨éå¸¸æ˜ç¡®çš„æƒ…å†µä¸‹æ‰§è¡Œredaction&amp;#x20;       \\# ä¾‹å¦‚ï¼Œå¦‚æœä½ çŸ¥é“æ°´å°æ˜¯æŸä¸ªç‰¹å®šåç§°çš„Form XObjectï¼Œä½†é€šå¸¸PyMuPDFä¸ç›´æ¥æš´éœ²è¿™ä¸ª&amp;#x20;       print(f&quot;Warning: Method 6 (deep\\_watermark\\_removal) in PyMuPDF is generally not feasible for direct object deletion without significant PDF internal structure parsing and modification, which is outside the scope of simple PyMuPDF APIs. Using redaction is the recommended safe approach.&quot;)&amp;#x20;       \\# å¦‚æœæ°´å°æ˜¯é€æ˜åº¦å¾ˆé«˜çš„å›¾åƒï¼Œå¯èƒ½éœ€è¦æ¸²æŸ“é¡µé¢ç„¶åç”¨å›¾åƒå¤„ç†æ¥è¯†åˆ«å¹¶redact&amp;#x20;       \\# è¿™é‡Œä¸ºäº†é¿å…è¯¯å¯¼ï¼Œä¸æä¾›å…·ä½“å®ç°ï¼Œä»…ä¿ç•™æ¡†æ¶ã€‚&amp;#x20;   doc.save(output\\_path)&amp;#x20;   doc.close()\n\nä»£ç è§£æï¼š\n\nè¿™ä¸ªæ–¹æ³•æ—¨åœ¨ç›´æ¥æ“ä½œ PDF çš„ XObject (å¤–éƒ¨å¯¹è±¡ï¼Œå¯ä»¥æ˜¯å›¾åƒæˆ– Form XObject) å’Œå†…å®¹æµã€‚\n\né‡è¦æç¤ºï¼š PyMuPDF (Fitz) å¹¶æ²¡æœ‰ç›´æ¥æš´éœ²ä¿®æ”¹æˆ–åˆ é™¤åº•å±‚ PDF å¯¹è±¡çš„ APIã€‚ add_redact_annot æ˜¯ PyMuPDF ä¸­æœ€å®‰å…¨å’Œæ¨èçš„æ–¹å¼æ¥ â€œåˆ é™¤â€ é¡µé¢å†…å®¹çš„ã€‚ç›´æ¥ä¿®æ”¹ PDF çš„åº•å±‚å†…å®¹æµéå¸¸å±é™©ï¼Œæ“ä½œä¸å½“å¾ˆå¯èƒ½å¯¼è‡´ PDF æ–‡ä»¶æŸåä¸”æ— æ³•æ‰“å¼€ã€‚\n\nå› æ­¤ï¼Œæˆ‘è°ƒæ•´äº†æ­¤æ–¹æ³•çš„æè¿°å’Œä»£ç ç¤ºä¾‹ï¼Œå¼ºè°ƒå…¶å¤æ‚æ€§å’Œé£é™©ï¼Œå¹¶æŒ‡å‡ºåœ¨ PyMuPDF ä¸­ï¼Œæ›´æ¨èä½¿ç”¨ add_redact_annot æ¥å®ç° â€œåˆ é™¤â€ æ•ˆæœã€‚å¦‚æœä½ çœŸçš„éœ€è¦æ·±å…¥åˆ° PDF åº•å±‚ä¿®æ”¹ï¼Œå¯èƒ½éœ€è¦æ›´ä¸“ä¸šçš„ PDF å¤„ç†åº“æˆ–å¯¹ PDF è§„èŒƒæœ‰æå…¶æ·±å…¥çš„äº†è§£ã€‚\n\n\néš¾æ˜“åº¦ï¼šâ˜…â˜…â˜…â˜…â˜… (ç†è®ºä¸Š)\nä¼˜ç‚¹ï¼š ç†è®ºä¸Šå¯ä»¥å½»åº•æ¸…é™¤ä¸ç•™ç—•è¿¹ï¼Œé€‚ç”¨äºå„ç§ç±»å‹æ°´å°ã€‚\nç¼ºç‚¹ï¼š å®ç°éå¸¸å¤æ‚ï¼Œéœ€è¦æ·±å…¥çš„ PDF ç»“æ„çŸ¥è¯†ï¼Œä¸”åœ¨ PyMuPDF ä¸­ç›´æ¥å®ç°æ­¤ç±»æ“ä½œéš¾åº¦æé«˜ä¸”é£é™©å¤§ã€‚\næ–¹æ³•å¯¹æ¯”ä¸é€‰æ‹©å»ºè®®\n\n\n\næ–¹æ³•&#xA;\néš¾æ˜“åº¦&#xA;\né€‚ç”¨åœºæ™¯&#xA;\nå…³é”®ä¼˜åŠ¿&#xA;\nå±€é™æ€§&#xA;\n\n\n\nå­—ä½“å¤§å° + æ—‹è½¬è§’åº¦&#xA;\nâ˜…â˜…â˜…â˜†â˜†&#xA;\næ°´å°æœ‰å›ºå®šå¤§å°å’Œå€¾æ–œè§’åº¦&#xA;\nå®ç°ç›¸å¯¹ç®€å•ï¼Œè¯†åˆ«å‡†ç¡®ç‡è¾ƒé«˜&#xA;\néœ€è¦ç²¾ç¡®çš„å¤§å°å’Œè§’åº¦å‚æ•°&#xA;\n\n\né€æ˜åº¦ + é¢œè‰²&#xA;\nâ˜…â˜…â˜…â˜…â˜†&#xA;\næ°´å°æœ‰å›ºå®šé¢œè‰²ï¼ˆç‰¹åˆ«æ˜¯æµ…è‰²ï¼‰&#xA;\nå¯¹æµ…è‰²æ°´å°æ•ˆæœå¥½&#xA;\né€æ˜åº¦æå–æ˜¯éš¾ç‚¹ï¼Œå¯èƒ½éœ€è¦æ·±å…¥è§£æ PDF å†…éƒ¨ç»“æ„æˆ–å€ŸåŠ©å›¾åƒå¤„ç†åº“&#xA;\n\n\nå¤šç‰¹å¾ç»¼åˆ&#xA;\nâ˜…â˜…â˜…â˜…â˜…&#xA;\næ°´å°ç‰¹å¾æ˜ç¡®ä¸”å›ºå®š&#xA;\nè¯†åˆ«å‡†ç¡®æ€§é«˜ï¼Œè¯¯åˆ¤ç‡æä½&#xA;\nå®ç°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç²¾ç¡®çš„æ°´å°ç‰¹å¾å‚æ•°&#xA;\n\n\nåŸºäºæ–‡æœ¬ç‰¹å¾&#xA;\nâ˜…â˜…â˜†â˜†â˜†&#xA;\nç®€å•æ–‡æœ¬æ°´å°&#xA;\nå®ç°ç®€å•ï¼Œå¤„ç†é€Ÿåº¦å¿«&#xA;\nä»…é€‚ç”¨äºæ–‡æœ¬æ°´å°ï¼Œæ— æ³•å¤„ç†å›¾åƒæ°´å°&#xA;\n\n\næ··åˆç‰¹å¾è¯†åˆ«&#xA;\nâ˜…â˜…â˜…â˜…â˜†&#xA;\nå¤æ‚æ°´å°ç¯å¢ƒï¼ˆæ–‡æœ¬ä¸å›¾åƒæ··åˆï¼‰&#xA;\nè¯†åˆ«ç²¾åº¦é«˜&#xA;\nå®ç°å¤æ‚ï¼Œéœ€è¦æ°´å°æ¨¡æ¿ï¼Œå¤„ç†é€Ÿåº¦æ…¢&#xA;\n\n\nåº•å±‚ç»“æ„å¤„ç†&#xA;\nâ˜…â˜…â˜…â˜…â˜…&#xA;\nå„ç§ç±»å‹æ°´å°&#xA;\nç†è®ºä¸Šæœ€å½»åº•&#xA;\né«˜é£é™©ï¼ŒPyMuPDF ä¸­éš¾ä»¥ç›´æ¥å®ç°ï¼Œéœ€è¦æ·±åšçŸ¥è¯†&#xA;\n\n\nç‰¹å¾å‚æ•°æå–æ–¹æ³•\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è·å–æ°´å°çš„ç‰¹å¾å‚æ•°ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆæ­¥æå–ï¼š\nimport fitzimport mathfrom collections import Counterdef extract\\_watermark\\_features(pdf\\_path, page\\_num=0):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   å°è¯•æå–PDFé¡µé¢ä¸­å¯èƒ½çš„æ°´å°æ–‡æœ¬ç‰¹å¾ã€‚&amp;#x20;   æ­¤å‡½æ•°ä¼šè¿”å›é¡µé¢ä¸­æœ€å¸¸è§çš„å­—ä½“å¤§å°ã€æ—‹è½¬è§’åº¦å’Œé¢œè‰²ã€‚&amp;#x20;   è¿™ä»…æ˜¯ä¸€ä¸ªåˆæ­¥åˆ†æå·¥å…·ï¼Œå¯¹äºå¤æ‚æ°´å°å¯èƒ½éœ€è¦äººå·¥ç¡®è®¤æˆ–æ›´å¤æ‚çš„ç»Ÿè®¡ã€‚&amp;#x20;   å‚æ•°:&amp;#x20;   pdf\\_path (str): PDFæ–‡ä»¶è·¯å¾„&amp;#x20;   page\\_num (int): è¦åˆ†æçš„é¡µé¢ç¼–å· (é»˜è®¤ä¸ºç¬¬ä¸€é¡µ)&amp;#x20;   è¿”å›:&amp;#x20;   dict: åŒ…å«å¯èƒ½çš„æ°´å°ç‰¹å¾çš„å­—å…¸ï¼Œå¦‚ &quot;font\\_size&quot;, &quot;rotation\\_angle&quot;, &quot;color\\_rgb&quot;, &quot;opacity&quot;(å ä½)&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   doc = fitz.open(pdf\\_path)&amp;#x20;   page = doc\\[page\\_num]&amp;#x20;   \\# ç”¨äºå­˜å‚¨å¯èƒ½çš„æ°´å°ç‰¹å¾&amp;#x20;   possible\\_font\\_sizes = \\[]&amp;#x20;   possible\\_rotations = \\[]&amp;#x20;   possible\\_colors = \\[]&amp;#x20;   \\# è·å–é¡µé¢ä¸Šçš„æ‰€æœ‰æ–‡æœ¬å’Œå®ƒä»¬çš„å±æ€§&amp;#x20;   text\\_infos = page.get\\_text(&quot;dict&quot;)&amp;#x20;   for block in text\\_infos\\[&quot;blocks&quot;]:&amp;#x20;       if &quot;lines&quot; in block:&amp;#x20;           for line in block\\[&quot;lines&quot;]:&amp;#x20;               for span in line\\[&quot;spans&quot;]:&amp;#x20;                   \\# æå–å­—ä½“å¤§å°&amp;#x20;                   possible\\_font\\_sizes.append(round(span\\[&quot;size&quot;], 1)) # å››èˆäº”å…¥åˆ°å°æ•°ç‚¹å1ä½ï¼Œä¾¿äºç»Ÿè®¡&amp;#x20;                   \\# è®¡ç®—æ—‹è½¬è§’åº¦&amp;#x20;                   matrix = fitz.Matrix(span\\[&quot;matrix&quot;])&amp;#x20;                   rotation = round(math.degrees(math.atan2(matrix.b, matrix.a)), 1) # å››èˆäº”å…¥ï¼Œä¾¿äºç»Ÿè®¡&amp;#x20;                   possible\\_rotations.append(rotation)&amp;#x20;                   \\# æå–é¢œè‰²ä¿¡æ¯&amp;#x20;                   color\\_int = span\\[&quot;color&quot;]&amp;#x20;                   r = (color\\_int &gt;&gt; 16) &amp; 0xFF&amp;#x20;                   g = (color\\_int &gt;&gt; 8) &amp; 0xFF&amp;#x20;                   b = color\\_int &amp; 0xFF&amp;#x20;                   possible\\_colors.append((r, g, b))&amp;#x20;   \\# ç®€å•åˆ†æï¼šæ‰¾å‡ºæœ€å¸¸è§çš„ç‰¹å¾å€¼ä½œä¸ºæ°´å°ç‰¹å¾&amp;#x20;   \\# å®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦æ›´å¤æ‚çš„èšç±»åˆ†ææˆ–äººå·¥ç¡®è®¤&amp;#x20;  &amp;#x20;&amp;#x20;   font\\_size = None&amp;#x20;   if possible\\_font\\_sizes:&amp;#x20;       font\\_size = Counter(possible\\_font\\_sizes).most\\_common(1)\\[0]\\[0]&amp;#x20;   rotation\\_angle = None&amp;#x20;   if possible\\_rotations:&amp;#x20;       rotation\\_angle = Counter(possible\\_rotations).most\\_common(1)\\[0]\\[0]&amp;#x20;       \\# æ—‹è½¬è§’åº¦å¯èƒ½ä¸ºè´Ÿï¼Œå°†å…¶è§„èŒƒåŒ–åˆ° 0-360 åº¦&amp;#x20;       if rotation\\_angle &lt; 0:&amp;#x20;           rotation\\_angle += 360&amp;#x20;   color\\_rgb = None&amp;#x20;   if possible\\_colors:&amp;#x20;       color\\_rgb = Counter(possible\\_colors).most\\_common(1)\\[0]\\[0]&amp;#x20;   doc.close()&amp;#x20;   return &#123;&amp;#x20;       &quot;font\\_size&quot;: font\\_size,&amp;#x20;       &quot;rotation\\_angle&quot;: rotation\\_angle,&amp;#x20;       &quot;color\\_rgb&quot;: color\\_rgb,&amp;#x20;       &quot;opacity&quot;: 0.5  # è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å€¼ï¼Œå®é™…ä¸­é€æ˜åº¦æå–éå¸¸å¤æ‚ï¼Œéœ€è¦æ‰‹åŠ¨ç¡®è®¤æˆ–æ›´é«˜çº§åˆ†æ&amp;#x20;   &#125;\\# ç¤ºä¾‹ç”¨æ³•\\# features = extract\\_watermark\\_features(&quot;your\\_watermarked\\_document.pdf&quot;)\\# print(features)\n\nä»£ç è§£æï¼š\n\næ­¤å‡½æ•°ä¼šéå†æŒ‡å®šé¡µé¢çš„æ‰€æœ‰æ–‡æœ¬è·¨åº¦ï¼Œæ”¶é›†å®ƒä»¬çš„å­—ä½“å¤§å°ã€æ—‹è½¬è§’åº¦å’Œé¢œè‰²ã€‚\n\nä¸ºäº†æ–¹ä¾¿ç»Ÿè®¡ï¼Œå¯¹æµ®ç‚¹æ•°ï¼ˆå¤§å°å’Œè§’åº¦ï¼‰è¿›è¡Œäº†å››èˆäº”å…¥ã€‚\n\nä½¿ç”¨ collections.Counter æ‰¾å‡ºæœ€å¸¸è§çš„å­—ä½“å¤§å°ã€æ—‹è½¬è§’åº¦å’Œé¢œè‰²ï¼Œä½œä¸ºå¯èƒ½çš„æ°´å°ç‰¹å¾ã€‚\n\næ³¨æ„ï¼š æå–é€æ˜åº¦ä»ç„¶æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œopacity å‚æ•°åœ¨æ­¤å¤„ä»ä½œä¸ºå ä½ç¬¦ï¼Œéœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆä¾‹å¦‚æ‰‹åŠ¨è§‚å¯Ÿæˆ–æ›´å¤æ‚çš„ PDF å†…å®¹æµè§£æï¼‰æ¥ç¡®å®šã€‚\n\n\næ€»ç»“ä¸æœ€ä½³å®è·µ\nåŸºäºç‰¹å¾çš„ PDF æ°´å°å¤„ç†æ–¹æ³•èƒ½å¤Ÿå®ç°æ›´ç²¾ç¡®çš„æ°´å°è¯†åˆ«å’Œå»é™¤ï¼Œä½†è¿™è¦æ±‚ä½ å¯¹æ°´å°çš„ç‰¹å¾æœ‰å……åˆ†äº†è§£ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘å»ºè®®ä½ éµå¾ªä»¥ä¸‹æœ€ä½³å®è·µï¼š\n\né¢„å¤„ç†åˆ†æï¼š é¦–å…ˆä½¿ç”¨ extract_watermark_features å‡½æ•°åˆ†ææ°´å°ç‰¹å¾ï¼Œåˆæ­¥äº†è§£æ°´å°çš„å­—ä½“å¤§å°ã€æ—‹è½¬è§’åº¦ã€é¢œè‰²ç­‰å…³é”®ä¿¡æ¯ã€‚å¿…è¦æ—¶ï¼Œæ‰‹å·¥è§‚å¯Ÿæ°´å°ï¼Œç¡®è®¤å…¶é€æ˜åº¦ã€å…·ä½“æ–‡æœ¬å†…å®¹æˆ–å›¾åƒæ ·å¼ã€‚\n\nä»ç®€åˆ°ç¹å°è¯•ï¼š ä»æœ€ç®€å•çš„æ–¹æ³•å¼€å§‹ã€‚å¦‚æœæ°´å°æ˜¯çº¯æ–‡æœ¬ä¸”ç‰¹å¾æ˜æ˜¾ï¼Œå¯ä»¥å…ˆå°è¯• åŸºäºæ–‡æœ¬ç‰¹å¾çš„ç›´æ¥åˆ é™¤æ³•ã€‚å¦‚æœæ°´å°æœ‰å›ºå®šçš„å­—ä½“å¤§å°å’Œå€¾æ–œè§’åº¦ï¼Œå°±ç”¨ åŸºäºå­—ä½“å¤§å°å’Œæ—‹è½¬è§’åº¦çš„æ–¹æ³•ã€‚åªæœ‰å½“ç®€å•æ–¹æ³•æ•ˆæœä¸ä½³æ—¶ï¼Œå†é€æ­¥å¢åŠ ç‰¹å¾ç»´åº¦ï¼Œå°è¯• å¤šç‰¹å¾ç»¼åˆè¯†åˆ«ã€‚\n\nåˆç†è°ƒæ•´å‚æ•°ï¼š æ ¹æ®å®é™…æ°´å°æƒ…å†µç»†è‡´è°ƒæ•´åŒ¹é…å®¹å·®å€¼ï¼Œåœ¨è¯†åˆ«å‡†ç¡®ç‡å’Œè¯¯åˆ¤ç‡ä¹‹é—´å–å¾—æœ€ä½³å¹³è¡¡ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå­—ä½“å¤§å°ï¼Œå¯ä»¥å…è®¸ 1.0 åˆ° 2.0 çš„è¯¯å·®èŒƒå›´ï¼›å¯¹äºæ—‹è½¬è§’åº¦ï¼Œå¯å…è®¸ 3 åˆ° 5 åº¦å·¦å³çš„è¯¯å·®ã€‚\n\nå¤æ‚åœºæ™¯ç»„åˆï¼š å¯¹äºåŒ…å«å¤šç§ç±»å‹æ°´å°çš„å¤æ‚ PDFï¼Œè€ƒè™‘ç»“åˆå¤šç§æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ—¢æœ‰æ–‡æœ¬åˆæœ‰å›¾åƒçš„æ··åˆæ°´å°ï¼Œå¯ä»¥ç»“åˆ æ··åˆç‰¹å¾è¯†åˆ«æ³•ã€‚\n\næ‰¹é‡å¤„ç†æŠ€å·§ï¼š å¦‚æœä½ éœ€è¦å¤„ç†å¤§é‡ PDF æ–‡ä»¶ï¼Œåˆ©ç”¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹å¯ä»¥æ˜¾è‘—æé«˜å¤„ç†æ•ˆç‡ã€‚\n\n\nfrom concurrent.futures import ThreadPoolExecutorimport osdef batch\\_process\\_pdfs(file\\_list, output\\_dir, \\*\\*watermark\\_params):&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   æ‰¹é‡å¤„ç†PDFæ–‡ä»¶ï¼Œä½¿ç”¨å¤šçº¿ç¨‹æé«˜æ•ˆç‡ã€‚&amp;#x20;   å‚æ•°:&amp;#x20;   file\\_list (list): åŒ…å«æ‰€æœ‰å¾…å¤„ç†PDFæ–‡ä»¶è·¯å¾„çš„åˆ—è¡¨&amp;#x20;   output\\_dir (str): å¤„ç†åPDFæ–‡ä»¶çš„è¾“å‡ºç›®å½•&amp;#x20;   \\*\\*watermark\\_params: ä¼ é€’ç»™ remove\\_watermark\\_by\\_multiple\\_features çš„æ°´å°ç‰¹å¾å‚æ•°&amp;#x20;   &quot;&quot;&quot;&amp;#x20;   os.makedirs(output\\_dir, exist\\_ok=True) # ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨&amp;#x20;   with ThreadPoolExecutor(max\\_workers=os.cpu\\_count()) as executor: # ä½¿ç”¨CPUæ ¸å¿ƒæ•°ä½œä¸ºæœ€å¤§å·¥ä½œçº¿ç¨‹æ•°&amp;#x20;       futures = \\[]&amp;#x20;       for file\\_path in file\\_list:&amp;#x20;           file\\_name = os.path.basename(file\\_path)&amp;#x20;           output\\_path = os.path.join(output\\_dir, file\\_name)&amp;#x20;           \\# æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± &amp;#x20;           futures.append(executor.submit(&amp;#x20;               remove\\_watermark\\_by\\_multiple\\_features,&amp;#x20;               file\\_path, output\\_path,\\*\\* watermark\\_params&amp;#x20;           ))&amp;#x20;       \\# ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ&amp;#x20;       for future in futures:&amp;#x20;           try:&amp;#x20;               future.result() # è·å–ç»“æœï¼Œå¦‚æœä»»åŠ¡æœ‰å¼‚å¸¸ä¼šåœ¨è¿™é‡ŒæŠ›å‡º&amp;#x20;               print(f&quot;æ–‡ä»¶å¤„ç†å®Œæˆï¼š&#123;file\\_path&#125;&quot;)&amp;#x20;           except Exception as exc:&amp;#x20;               print(f&quot;æ–‡ä»¶ &#123;file\\_path&#125; å¤„ç†æ—¶å‘ç”Ÿé”™è¯¯ï¼š&#123;exc&#125;&quot;)\\# ç¤ºä¾‹ç”¨æ³•\\# pdf\\_files\\_to\\_process = \\[&quot;doc1.pdf&quot;, &quot;doc2.pdf&quot;] # ä½ çš„PDFæ–‡ä»¶åˆ—è¡¨\\# output\\_folder = &quot;processed\\_pdfs&quot;\\# watermark\\_features = &#123;\\#     &quot;font\\_size&quot;: 36.0,\\#     &quot;rotation\\_angle&quot;: 30.0,\\#     &quot;color\\_rgb&quot;: (192, 192, 192) # æµ…ç°è‰²\\# &#125;\\# batch\\_process\\_pdfs(pdf\\_files\\_to\\_process, output\\_folder, \\*\\*watermark\\_features)\n\n\n\n\næ“ä½œå®‰å…¨ä¿éšœï¼š åœ¨å¤„ç†ä»»ä½•é‡è¦æ–‡ä»¶ä¹‹å‰ï¼ŒåŠ¡å¿…å…ˆå¤‡ä»½åŸå§‹æ–‡ä»¶ï¼è¿™èƒ½ç¡®ä¿å³ä½¿å¤„ç†ä¸å½“ï¼Œä½ ä¹Ÿä¸ä¼šä¸¢å¤±åŸå§‹æ•°æ®ã€‚åŒæ—¶ï¼Œè¯·å§‹ç»ˆéµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ï¼Œä»…å¤„ç†ä½ æœ‰æƒä¿®æ”¹çš„æ–‡æ¡£ï¼Œå°Šé‡çŸ¥è¯†äº§æƒå’Œç‰ˆæƒä¿æŠ¤ã€‚\n\né€šè¿‡åˆç†é€‰æ‹©å’Œç»„åˆè¿™äº›æ–¹æ³•ï¼Œä½ å°±èƒ½é«˜æ•ˆä¸”ç²¾å‡†åœ°å¤„ç†å„ç§å…·æœ‰ç‰¹å®šç‰¹å¾çš„ PDF æ°´å°ã€‚\n","categories":["PDF å¤„ç†","Python","æ•°æ®å¤„ç†"],"tags":["Python","PyMuPDF","PDF","æ°´å°å»é™¤","ç‰¹å¾è¯†åˆ«","æ–‡æœ¬å¤„ç†"]},{"title":"ä»é›¶å¼€å§‹çš„çˆ¬è™«ç”Ÿæ´»ï¼ˆä¸€ï¼‰ï¼šç¯å¢ƒæ­å»ºä¸åŸºç¡€åº“åº”ç”¨","url":"/2025/07/15/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E7%88%AC%E8%99%AB%E7%94%9F%E6%B4%BB%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%9F%BA%E7%A1%80%E5%BA%93%E5%BA%94%E7%94%A8/","content":"ä»é›¶å¼€å§‹çš„çˆ¬è™«ç”Ÿæ´»ï¼ˆä¸€ï¼‰ï¼šç¯å¢ƒæ­å»ºä¸åŸºç¡€åº“åº”ç”¨\nä¸€ã€ç¯å¢ƒæ­å»º\nåœ¨å¼€å§‹å­¦ä¹ çˆ¬è™«ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ­å»ºå¥½å¼€å‘ç¯å¢ƒã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å·¥å…·å’Œåº“ï¼š\n1. Python ç¯å¢ƒ&#xA;ç¡®ä¿å·²ç»å®‰è£…äº† Python 3.x ç‰ˆæœ¬ã€‚å¯ä»¥å‰å¾€ Python å®˜ç½‘ ä¸‹è½½å®‰è£…ã€‚\n2. å¸¸ç”¨åº“å®‰è£…&#xA;ä½¿ç”¨ pip å‘½ä»¤å®‰è£…ä»¥ä¸‹åº“ï¼š\npip install seleniumpip install beautifulsoup4pip install pyquerypip install pymysqlpip install pymongopip install redis\n\n3. æµè§ˆå™¨é©±åŠ¨&#xA;\nChromeDriverï¼šæ ¹æ®ä½ ä½¿ç”¨çš„ Chrome æµè§ˆå™¨ç‰ˆæœ¬ï¼Œä¸‹è½½å¯¹åº”çš„ ChromeDriverã€‚\n\nPhantomJSï¼ˆå·²å¼ƒç”¨ï¼‰ï¼šåœ¨ Selenium 4.x ä¸­å·²ç§»é™¤ï¼Œå»ºè®®ä½¿ç”¨æ— å¤´æ¨¡å¼çš„ Chromeã€‚\n\n\né…ç½® Chrome æ— å¤´æ¨¡å¼ç¤ºä¾‹ï¼š\nfrom selenium import webdriverfrom selenium.webdriver.chrome.options import Options\\# é…ç½® Chrome ä¸ºæ— å¤´æ¨¡å¼chrome\\_options = Options()chrome\\_options.add\\_argument(&quot;--headless&quot;)  # æ— å¤´æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºæµè§ˆå™¨çª—å£\\# åˆ›å»º Chrome æµè§ˆå™¨å®ä¾‹driver = webdriver.Chrome(options=chrome\\_options)driver.get(&quot;https://www.example.com&quot;)print(driver.title)driver.quit()\n\näºŒã€åŸºç¡€åº“åº”ç”¨\n1. BeautifulSoup åº“&#xA;BeautifulSoup æ˜¯ä¸€ä¸ªç”¨äºè§£æ HTML å’Œ XML æ–‡æ¡£çš„åº“ã€‚ç¤ºä¾‹ï¼š\nfrom bs4 import BeautifulSouphtml\\_doc = &quot;&quot;&quot;\\&lt;html&gt;&amp;#x20;   \\&lt;head&gt;&amp;#x20;       \\&lt;title&gt;ç¤ºä¾‹é¡µé¢\\&lt;/title&gt;&amp;#x20;   \\&lt;/head&gt;&amp;#x20;   \\&lt;body&gt;&amp;#x20;       \\&lt;h1&gt;æ ‡é¢˜\\&lt;/h1&gt;&amp;#x20;       \\&lt;p&gt;æ®µè½å†…å®¹\\&lt;/p&gt;&amp;#x20;   \\&lt;/body&gt;\\&lt;/html&gt;&quot;&quot;&quot;soup = BeautifulSoup(html\\_doc, &#x27;html.parser&#x27;)print(soup.title.string)  # è¾“å‡ºæ ‡é¢˜å†…å®¹\n\n2. PyQuery åº“&#xA;PyQuery æ˜¯ä¸€ä¸ªç±» jQuery çš„ Python åº“ï¼Œç”¨äºæ“ä½œ HTML æ–‡æ¡£ã€‚ç¤ºä¾‹ï¼š\nfrom pyquery import PyQuery as pqhtml\\_doc = &quot;&quot;&quot;\\&lt;html&gt;&amp;#x20;   \\&lt;head&gt;&amp;#x20;       \\&lt;title&gt;ç¤ºä¾‹é¡µé¢\\&lt;/title&gt;&amp;#x20;   \\&lt;/head&gt;&amp;#x20;   \\&lt;body&gt;&amp;#x20;       \\&lt;h1&gt;æ ‡é¢˜\\&lt;/h1&gt;&amp;#x20;       \\&lt;p&gt;æ®µè½å†…å®¹\\&lt;/p&gt;&amp;#x20;   \\&lt;/body&gt;\\&lt;/html&gt;&quot;&quot;&quot;doc = pq(html\\_doc)print(doc(&#x27;title&#x27;).text())  # è¾“å‡ºæ ‡é¢˜å†…å®¹\n\n3. Requests åº“&#xA;Requests æ˜¯ä¸€ä¸ªç®€å•çš„ HTTP åº“ï¼Œç”¨äºå‘é€ç½‘ç»œè¯·æ±‚ã€‚ç¤ºä¾‹ï¼š\nimport requestsurl = &quot;https://www.example.com&quot;response = requests.get(url)print(response.text)  # è¾“å‡ºç½‘é¡µå†…å®¹\n\nä¸‰ã€æ•°æ®å­˜å‚¨\n1. MySQL æ•°æ®åº“&#xA;ä½¿ç”¨ PyMySQL è¿æ¥å’Œæ“ä½œ MySQL æ•°æ®åº“ï¼š\nimport pymysqlconn = pymysql.connect(&amp;#x20;   host=&#x27;localhost&#x27;,&amp;#x20;   user=&#x27;root&#x27;,&amp;#x20;   password=&#x27;123456&#x27;,&amp;#x20;   port=3306,&amp;#x20;   db=&#x27;mysql&#x27;)cursor = conn.cursor()cursor.execute(&#x27;SELECT \\* FROM db&#x27;)print(cursor.fetchone())conn.close()\n\n2. MongoDB æ•°æ®åº“&#xA;ä½¿ç”¨ PyMongo è¿æ¥å’Œæ“ä½œ MongoDB æ•°æ®åº“ï¼š\nimport pymongoclient = pymongo.MongoClient(&#x27;localhost&#x27;)db = client\\[&#x27;newtestdb&#x27;]db\\[&#x27;table&#x27;].insert\\_one(&#123;&#x27;name&#x27;: &#x27;Bob&#x27;&#125;)result = db\\[&#x27;table&#x27;].find\\_one(&#123;&#x27;name&#x27;: &#x27;Bob&#x27;&#125;)print(result)\n\n3. Redis æ•°æ®åº“&#xA;ä½¿ç”¨ RedisPy è¿æ¥å’Œæ“ä½œ Redis æ•°æ®åº“ï¼š\nimport redisr = redis.Redis(&#x27;localhost&#x27;, 6379)r.set(&#x27;name&#x27;, &#x27;Bob&#x27;)result = r.get(&#x27;name&#x27;)print(result)\n\nå››ã€çˆ¬è™«åŸºæœ¬æµç¨‹\nçˆ¬è™«çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š\n\nå‘é€è¯·æ±‚ï¼šä½¿ç”¨ Requests åº“å‘é€ HTTP è¯·æ±‚è·å–ç½‘é¡µå†…å®¹ã€‚\n\nè§£æå“åº”ï¼šä½¿ç”¨ BeautifulSoup æˆ– PyQuery åº“è§£æç½‘é¡µå†…å®¹ï¼Œæå–æ‰€éœ€æ•°æ®ã€‚\n\nä¿å­˜æ•°æ®ï¼šå°†æå–çš„æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“æˆ–æ–‡ä»¶ä¸­ã€‚\n\n\nç¤ºä¾‹ï¼šçˆ¬å–çŒ«çœ¼ç”µå½± TOP100\nimport requestsimport reimport jsonfrom multiprocessing import Pooldef get\\_one\\_page(url):&amp;#x20;   headers = &#123;&amp;#x20;       &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36 Edg/137.0.0.0&#x27;&amp;#x20;   &#125;&amp;#x20;   response = requests.get(url, headers=headers)&amp;#x20;   if response.status\\_code == 200:&amp;#x20;       return response.text&amp;#x20;   return Nonedef parse\\_one\\_page(html):&amp;#x20;   pattern = re.compile(&#x27;\\&lt;dd&gt;.\\*?board-index.\\*?&gt;(\\d+)\\&lt;/i&gt;.\\*?data-src=&quot;(.\\*?)&quot;.\\*?name&quot;&gt;\\&lt;a&#x27;&amp;#x20;                        \\+ &#x27;.\\*?&gt;(.\\*?)\\&lt;/a&gt;.\\*?star&quot;&gt;(.\\*?)\\&lt;/p&gt;.\\*?releasetime&quot;&gt;(.\\*?)\\&lt;/p&gt;&#x27;&amp;#x20;                        \\+ &#x27;.\\*?integer&quot;&gt;(.\\*?)\\&lt;/i&gt;.\\*?fraction&quot;&gt;(.\\*?)\\&lt;/i&gt;.\\*?\\&lt;/dd&gt;&#x27;, re.S)&amp;#x20;   items = re.findall(pattern, html)&amp;#x20;   for item in items:&amp;#x20;       yield &#123;&amp;#x20;           &#x27;index&#x27;: item\\[0],&amp;#x20;           &#x27;image&#x27;: item\\[1],&amp;#x20;           &#x27;title&#x27;: item\\[2],&amp;#x20;           &#x27;actor&#x27;: item\\[3].strip()\\[3:],&amp;#x20;           &#x27;time&#x27;: item\\[4].strip()\\[5:],&amp;#x20;           &#x27;score&#x27;: item\\[5] + item\\[6]&amp;#x20;       &#125;def write\\_to\\_file(content):&amp;#x20;   with open(&#x27;result.txt&#x27;, &#x27;a&#x27;, encoding=&#x27;utf-8&#x27;) as f:&amp;#x20;       f.write(json.dumps(content, ensure\\_ascii=False) + &#x27;\\n&#x27;)def main(offset):&amp;#x20;   url = &#x27;http://maoyan.com/board/4?offset=&#x27; + str(offset)&amp;#x20;   html = get\\_one\\_page(url)&amp;#x20;   for item in parse\\_one\\_page(html):&amp;#x20;       print(item)&amp;#x20;       write\\_to\\_file(item)if \\_\\_name\\_\\_ == &#x27;\\_\\_main\\_\\_&#x27;:&amp;#x20;   pool = Pool()&amp;#x20;   pool.map(main, \\[i \\* 10 for i in range(10)])\n\näº”ã€åŠ¨æ€ç½‘é¡µå¤„ç†\nå¯¹äºåŠ¨æ€åŠ è½½çš„ç½‘é¡µï¼Œå¯ä»¥ä½¿ç”¨ Selenium æ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œã€‚ç¤ºä¾‹ï¼š\nfrom selenium import webdriverfrom selenium.webdriver.common.by import Bydriver = webdriver.Chrome()driver.get(&#x27;https://www.taobao.com&#x27;)input = driver.find\\_element(By.ID, &#x27;q&#x27;)input.send\\_keys(&#x27;ç¾é£Ÿ&#x27;)button = driver.find\\_element(By.CLASS\\_NAME, &#x27;btn-search&#x27;)button.click()driver.quit()\n\nå…­ã€çˆ¬è™«æ¡†æ¶\n1. Scrapy æ¡†æ¶&#xA;Scrapy æ˜¯ä¸€ä¸ªå¼ºå¤§çš„çˆ¬è™«æ¡†æ¶ï¼Œå¯ä»¥ç®€åŒ–çˆ¬è™«å¼€å‘è¿‡ç¨‹ã€‚å®‰è£…å‘½ä»¤ï¼š\npip install scrapy\n","categories":["çˆ¬è™«æ•™ç¨‹"],"tags":["Pythonçˆ¬è™«","æ•°æ®æŠ“å–","Selenium","BeautifulSoup","æ•°æ®å­˜å‚¨"]},{"title":"æ­ç§˜xlsxwriterï¼šå¯Œæ–‡æœ¬æ ¼å¼å¦‚ä½•ç²¾å‡†â€œæŸ“è‰²â€ï¼Ÿ'","url":"/2025/07/16/xlsxwriter%EF%BC%9A%E5%AF%8C%E6%96%87%E6%9C%AC%E6%A0%BC%E5%BC%8F%E5%A6%82%E4%BD%95%E7%B2%BE%E5%87%86%E2%80%9C%E6%9F%93%E8%89%B2%E2%80%9D%EF%BC%9F/","content":"æ ¸å¿ƒæ¦‚å¿µ\nxlsxwriter é€šè¿‡å•å…ƒæ ¼æ ¼å¼å’Œæ–‡æœ¬ä½ç½®ç´¢å¼•æ¥ç²¾ç¡®æ§åˆ¶æ–‡æœ¬åŒºé—´æ ·å¼ï¼Œå…¶åˆ¤å®šé€»è¾‘åŸºäºä»¥ä¸‹å…³é”®å†…å®¹ï¼š\n1. æ–‡æœ¬åŒºé—´å®šä¹‰æ–¹å¼&#xA;\\# åŸºæœ¬è¯­æ³•ï¼ˆéçœŸå®ä»£ç ï¼Œä»…ç¤ºæ„é€»è¾‘ï¼‰worksheet.write\\_rich\\_string(&amp;#x20;   row, col,&amp;#x20;&amp;#x20;   \\[format1, &quot;çº¢è‰²æ–‡æœ¬&quot;, format2, &quot;æ™®é€šæ–‡æœ¬&quot;])\n\n\n\n\nä½ç½®åˆ¤å®šï¼šæ ¹æ®å­—ç¬¦ä¸²åœ¨å‚æ•°åˆ—è¡¨ä¸­çš„é¡ºåºç¡®å®šä½ç½®\n\næ ¼å¼ç»§æ‰¿ï¼šæ ¼å¼å¯¹è±¡ä½œç”¨äºç´§éšå…¶åçš„æ–‡æœ¬æ®µ\n\n\n2. å…³é”®åˆ¤å®šè§„åˆ™&#xA;\n\n\nåˆ¤å®šç»´åº¦&#xA;\nè¯´æ˜&#xA;\n\n\n\næ ¼å¼å¯¹è±¡ä½ç½®&#xA;\næ ¼å¼æ€»æ˜¯åº”ç”¨äºä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²å…ƒç´ &#xA;\n\n\næ–‡æœ¬åˆ†æ®µ&#xA;\næ¯ä¸ªå­—ç¬¦ä¸²å…ƒç´ è¢«è§†ä¸ºç‹¬ç«‹æ–‡æœ¬æ®µ&#xA;\n\n\nç©ºæ ¼å¼å¤„ç†&#xA;\nNone æˆ–çœç•¥æ ¼å¼æ—¶ç»§æ‰¿å•å…ƒæ ¼é»˜è®¤æ ¼å¼&#xA;\n\n\nç‰¹æ®Šå­—ç¬¦&#xA;\næ¢è¡Œç¬¦ (\\n) ä¼šåˆ›å»ºæ–°æ–‡æœ¬æ®µä½†ä¸ä¸­æ–­æ ¼å¼åº”ç”¨&#xA;\n\n\n3. å®é™…åº”ç”¨ç¤ºä¾‹&#xA;æ¡ˆä¾‹ 1ï¼šåŸºç¡€çº¢é»‘æ–‡æœ¬&#xA;red = workbook.add\\_format(&#123;&#x27;color&#x27;: &#x27;red&#x27;&#125;)black = workbook.add\\_format(&#123;&#x27;color&#x27;: &#x27;black&#x27;&#125;)\\# &quot;ç­”æ¡ˆ&quot;çº¢è‰²ï¼Œ&quot;:&quot;é»‘è‰²ï¼Œ&quot;42&quot;çº¢è‰²worksheet.write\\_rich\\_string(&#x27;A1&#x27;,&amp;#x20;&amp;#x20;   red, &#x27;ç­”æ¡ˆ&#x27;,&amp;#x20;&amp;#x20;   black, &#x27;:&#x27;,&amp;#x20;&amp;#x20;   red, &#x27;42&#x27;)\n\nå†…å­˜ä¸­çš„åŒºé—´æ˜ å°„ï¼š\n\\[0-2): çº¢è‰²æ ¼å¼ (å¯¹åº”&quot;ç­”æ¡ˆ&quot;)\\[2-3): é»‘è‰²æ ¼å¼ (å¯¹åº”&quot;:&quot;)&amp;#x20;\\[3-5): çº¢è‰²æ ¼å¼ (å¯¹åº”&quot;42&quot;)\n\næ¡ˆä¾‹ 2ï¼šå¸¦æ ¼å¼ç»§æ‰¿çš„æ–‡æœ¬&#xA;bold = workbook.add\\_format(&#123;&#x27;bold&#x27;: True&#125;)default = workbook.add\\_format()\\# &quot;æ³¨æ„&quot;åŠ ç²—ï¼Œåç»­æ–‡æœ¬é»˜è®¤æ ¼å¼worksheet.write\\_rich\\_string(&#x27;A2&#x27;,&amp;#x20;   bold, &#x27;æ³¨æ„&#x27;,&amp;#x20;&amp;#x20;   None, &#x27;ï¼šè¯·æ£€æŸ¥æ•°æ®&#x27;  # Noneç»§æ‰¿å•å…ƒæ ¼é»˜è®¤æ ¼å¼)\n\n4. ç‰¹æ®Šåœºæ™¯å¤„ç†&#xA;æ··åˆæ ¼å¼æ–‡æœ¬&#xA;\\# åŒä¸€å•è¯ä¸­éƒ¨åˆ†å­—æ¯æ ‡çº¢worksheet.write\\_rich\\_string(&#x27;A3&#x27;,&amp;#x20;   black, &#x27;Pri&#x27;,&amp;#x20;&amp;#x20;   red, &#x27;mar&#x27;,&amp;#x20;&amp;#x20;   black, &#x27;y&#x27;)\n\næ•ˆæœï¼šæ˜¾ç¤ºä¸º â€œPrimaryâ€ å…¶ä¸­ â€œmarâ€ ä¸ºçº¢è‰²\nåŠ¨æ€æ–‡æœ¬æ„å»º&#xA;parts = \\[black, &quot;éšæœºå€¼ï¼š&quot;]if highlight:&amp;#x20;   parts.extend(\\[red, str(value)])else:&amp;#x20;   parts.extend(\\[black, str(value)])&amp;#x20;  &amp;#x20;worksheet.write\\_rich\\_string(&#x27;A4&#x27;, \\*parts)\n\n5. åº•å±‚å®ç°åŸç†&#xA;\nOpenXML æ˜ å°„ï¼šæœ€ç»ˆç”Ÿæˆç±»ä¼¼ä»¥ä¸‹ XML ç»“æ„\n\n\\&lt;r&gt;&amp;#x20; \\&lt;rPr&gt;\\&lt;color rgb=&quot;FFFF0000&quot;/&gt;\\&lt;/rPr&gt;&amp;#x20; \\&lt;t&gt;ç­”æ¡ˆ\\&lt;/t&gt;\\&lt;/r&gt;\\&lt;r&gt;&amp;#x20; \\&lt;rPr&gt;\\&lt;color rgb=&quot;FF000000&quot;/&gt;\\&lt;/rPr&gt;&amp;#x20; \\&lt;t&gt;:\\&lt;/t&gt;\\&lt;/r&gt;\n\n\n\n\nç´¢å¼•è®¡ç®—ï¼šåº“å†…éƒ¨ç»´æŠ¤æ ¼å¼æ ˆï¼Œæ ¹æ®å‚æ•°é¡ºåºè®¡ç®—æ¯ä¸ªæ–‡æœ¬æ®µçš„èµ·æ­¢ä½ç½®\n\n6. ä½¿ç”¨é™åˆ¶ä¸æ³¨æ„äº‹é¡¹&#xA;\nä¸å¯å˜ç‰¹æ€§ï¼šä¸€æ—¦å†™å…¥æ— æ³•ä¿®æ”¹å•ä¸ªæ–‡æœ¬æ®µæ ¼å¼\n\næ€§èƒ½å½±å“ï¼šæ¯ä¸ªæ ¼å¼å˜åŒ–éƒ½ä¼šåˆ›å»ºæ–°çš„&lt;r&gt;å…ƒç´ ï¼Œè¿‡å¤šåˆ†æ®µå½±å“æ–‡ä»¶å¤§å°\n\nè¾¹ç•Œæƒ…å†µï¼š\n\nç©ºå­—ç¬¦ä¸²ä»ä¼šå ç”¨æ ¼å¼åŒºé—´\n\nè¿ç»­çš„ç›¸åŒæ ¼å¼ä¸ä¼šè‡ªåŠ¨åˆå¹¶\n\n\n\n\n7. è°ƒè¯•æŠ€å·§&#xA;\\# æŸ¥çœ‹å®é™…ç”Ÿæˆçš„XMLï¼ˆéœ€è¦ä¿å­˜æ–‡ä»¶åè§£å‹æŸ¥çœ‹ï¼‰workbook.filename = &#x27;output.xlsx&#x27;workbook.close()\\# è§£å‹åæŸ¥çœ‹xl/worksheets/sheet1.xml\n\næœ€ä½³å®è·µå»ºè®®&#xA;\næ‰¹é‡åˆå¹¶ç›¸åŒæ ¼å¼çš„æ–‡æœ¬æ®µ\n\nå¯¹é™æ€å†…å®¹é¢„å…ˆç”Ÿæˆæ ¼å¼åˆ—è¡¨\n\né¿å…å•ä¸ªå•å…ƒæ ¼å†…è¶…è¿‡ 20 ä¸ªæ ¼å¼åˆ†æ®µ\n\nå¯¹åŠ¨æ€å†…å®¹ä½¿ç”¨è¾…åŠ©å‡½æ•°æ„å»ºå‚æ•°åˆ—è¡¨\n\n\ndef build\\_rich\\_text(text\\_parts):&amp;#x20;   result = \\[]&amp;#x20;   for text, fmt in text\\_parts:&amp;#x20;       result.extend(\\[fmt, text])&amp;#x20;   return result\n\næ³¨ï¼šä¸ openpyxl çš„ CellRichText ä¸åŒï¼Œxlsxwriter é‡‡ç”¨æ›´åº•å±‚çš„æ ¼å¼ç»‘å®šæœºåˆ¶ï¼Œå¯¹æ–‡æœ¬åŒºé—´çš„åˆ¤å®šå®Œå…¨åŸºäºå‚æ•°åºåˆ—é¡ºåºï¼Œä¸ä¾èµ–ä»»ä½•æ–‡æœ¬æ ‡è®°ç¬¦å·ã€‚\nå…³é”®è¦ç‚¹æ€»ç»“&#xA;\nxlsxwriter çš„æ–‡æœ¬åŒºé—´åˆ¤å®šæ˜¯é¡ºåºæ•æ„Ÿçš„\n\næ ¼å¼å¯¹è±¡æ€»æ˜¯å‘å‰ç»‘å®šåˆ°ä¸‹ä¸€ä¸ªæ–‡æœ¬å…ƒç´ \n\nå®é™…æ¸²æŸ“æ—¶ä¼šå°†æ–‡æœ¬åŒºé—´æ˜ å°„ä¸º OpenXML çš„&lt;r&gt;å…ƒç´ \n\nå¤„ç†å¯Œæ–‡æœ¬æ—¶éœ€è¦ç‰¹åˆ«æ³¨æ„å‚æ•°åˆ—è¡¨çš„æ„å»ºé¡ºåº\n\n\n","categories":["Pythonåº“åº”ç”¨"],"tags":["Excel","Python","xlsxwriter","æ ¼å¼åŒ–"]}]